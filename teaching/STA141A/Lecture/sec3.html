<!DOCTYPE html>
<html lang="en"><head>
<script src="sec3_files/libs/clipboard/clipboard.min.js"></script>
<script src="sec3_files/libs/quarto-html/tabby.min.js"></script>
<script src="sec3_files/libs/quarto-html/popper.min.js"></script>
<script src="sec3_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="sec3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sec3_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="sec3_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="sec3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.57">

  <meta name="author" content="Akira Horiguchi">
  <title>s3: exploring data using tidyverse</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="sec3_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="sec3_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="sec3_files/libs/revealjs/dist/theme/quarto.css">
  <link href="sec3_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="sec3_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="sec3_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="sec3_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">s3: exploring data using tidyverse</h1>
  <p class="subtitle">STA141A: Fundamentals of Statistical Data Science</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Akira Horiguchi 
</div>
</div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/tidyverse" id="/toc-tidyverse"><code>tidyverse</code></a></li>
<li><a href="#/importing-data" id="/toc-importing-data">Importing data</a></li>
<li><a href="#/subsetting-a-data-frame" id="/toc-subsetting-a-data-frame">Subsetting a data frame</a></li>
<li><a href="#/inspect-a-data-frame" id="/toc-inspect-a-data-frame">Inspect a data frame</a></li>
<li><a href="#/reshaping-a-data-frame" id="/toc-reshaping-a-data-frame">Reshaping a data frame</a></li>
<li><a href="#/complex-calculations" id="/toc-complex-calculations">Complex calculations</a></li>
<li><a href="#/operating-on-logical-vectors" id="/toc-operating-on-logical-vectors">Operating on logical vectors</a></li>
<li><a href="#/operating-on-numeric-vectors" id="/toc-operating-on-numeric-vectors">Operating on numeric vectors</a></li>
<li><a href="#/visualizing-data-with-ggplot2" id="/toc-visualizing-data-with-ggplot2">Visualizing data with <code>ggplot2</code></a></li>
</ul>
</nav>
</section>
<section id="quick-note" class="slide level2">
<h2>Quick note</h2>

<img data-src="program.png" class="r-stretch quarto-figure-center"><p class="caption">Wickham and Grolemund (2017)</p><p>This slide deck (3-4 lectures) is meant to get you started working with data: Import, Tidy, Transform, Visualize. (Modeling will be middle half of this course.)</p>
<ul>
<li>By no means is it exhaustive.</li>
<li>Too much? Too little? Strongly depends on previous experience.</li>
<li><strong>PRACTICE</strong> with basic tools to get comfortable before learning new ones.</li>
</ul>
</section>
<section>
<section id="tidyverse" class="title-slide slide level1 center">
<h1><code>tidyverse</code></h1>

</section>
<section id="tidyverse-approach-to-data-manipulation" class="slide level2">
<h2><code>tidyverse</code> approach to data manipulation</h2>
<p>Why use <code>tidyverse</code> over base R or <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html"><code>data.table</code></a> or other packages?</p>
<blockquote>
<p>The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures. — https://www.tidyverse.org/</p>
</blockquote>
<ul>
<li>Consistent syntax.</li>
<li>Many people work full-time (and get paid!) to make new packages, add new functionality, etc.
<ul>
<li>In contrast, many other packages are created/maintained/updated by researchers who work on this part-time.</li>
</ul></li>
<li>Downside: slow for large data sets. (Use <code>data.table</code> instead.)</li>
</ul>
<p>This slide deck will primarily use <code>tidyverse</code> solutions, but it’s always good to know base R solutions.</p>
</section>
<section id="reminder-about-packages" class="slide level2">
<h2>Reminder about packages</h2>
<ul>
<li>Packages are things we load using <code>library()</code>.</li>
<li>If you haven’t installed a package <code>PACKAGENAME</code> before, you’ll get an error.</li>
<li>To install a package: <code>install.packages("PACKAGENAME")</code>.</li>
<li>To load a package: <code>library(PACKAGENAME)</code>.</li>
<li>For example:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)  <span class="co"># Do just once</span></span>
<span id="cb1-2"><a href=""></a><span class="fu">library</span>(tidyverse)  <span class="co"># Do at the start of every session</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-example-dataset" class="slide level2">
<h2>Load example dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a><span class="fu">library</span>(nycflights13) <span class="co"># loads the `flights` tibble into environment</span></span>
<span id="cb2-2"><a href=""></a>flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="piping-and" class="slide level2">
<h2>Piping: <code>%&gt;%</code> and <code>|&gt;</code></h2>
<p>The operator <code>%&gt;%</code> (requires the <code>magrittr</code> package) allow you to write operations sequentially.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a><span class="fu">mean</span>(flights<span class="sc">$</span>distance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1039.913</code></pre>
</div>
</div>
<p>Can instead pipe an output into the (first) argument of another function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href=""></a>flights<span class="sc">$</span>distance <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href=""></a>  <span class="fu">mean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1039.913</code></pre>
</div>
</div>
<p>Can also use <code>|&gt;</code>, which is included in R 4.1.0 (no need to install another package)</p>
</section>
<section id="piping-and-1" class="slide level2">
<h2>Piping: <code>%&gt;%</code> and <code>|&gt;</code></h2>
<p>Why pipe? Can be easier to read and understand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a><span class="fu">mean</span>(<span class="fu">sqrt</span>(<span class="fu">log</span>(flights<span class="sc">$</span>distance)))  <span class="co"># somewhat difficult to read</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.580285</code></pre>
</div>
</div>
<p>vs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a>flights<span class="sc">$</span>distance <span class="sc">|&gt;</span>  <span class="co"># easier to read</span></span>
<span id="cb10-2"><a href=""></a>  <span class="fu">log</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href=""></a>  <span class="fu">sqrt</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href=""></a>  <span class="fu">mean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.580285</code></pre>
</div>
</div>
<p>We will see more complex examples of this shortly.</p>
<!-- ## Piping with `magrittr`: `%>%` -->
<!-- The operator `%>%` (requires the `magrittr` package) allow you to write operations sequentially. -->
<!-- ```{r} -->
<!-- mean(sqrt(flights$distance)) -->
<!-- ``` -->
<!-- Same as: -->
<!-- ```{r} -->
<!-- flights$distance %>% -->
<!--   sqrt() %>% -->
<!--   mean() -->
<!-- ``` -->
<!-- Easier to read.  -->
<!-- We will see more complex examples of this shortly.  -->
<!-- ## Piping with `magrittr`: `%>%` -->
<!-- By default, `%>%` pipes the output into the first argument of the proceding function. -->
<!-- - You can also pipe output into the second argument of a function using `.` -->
<!-- ```{r} -->
<!-- c(2, exp(1), 10) %>% -->
<!--   log(100, base=.) -->
<!-- ``` -->
<!-- ## Piping: `|>` -->
<!-- The operator `|>` (introduced in R 4.1.0 package) allow you to write operations sequentially. -->
<!-- ```{r} -->
<!-- mean(sqrt(flights$distance)) -->
<!-- ``` -->
<!-- Same as: -->
<!-- ```{r} -->
<!-- flights$distance |> -->
<!--   sqrt() |> -->
<!--   mean() -->
<!-- ``` -->
<!-- ## Piping: `|>` -->
<!-- By default, `|>` pipes the output into the first argument of the proceding function. -->
<!-- - You can also pipe output into the second argument of a function using `_` -->
<!-- ```{r} -->
<!-- c(2, exp(1), 10) |> -->
<!--   log(100, base=_) -->
<!-- ``` -->
</section></section>
<section>
<section id="importing-data" class="title-slide slide level1 center">
<h1>Importing data</h1>

</section>
<section id="introduction" class="slide level2">
<h2>Introduction</h2>
<p>We have seen data sets that are either built into base R or come from external packages</p>
<ul>
<li>We will eventually want to import data from external <em>files</em></li>
</ul>
<p>Types of data files</p>
<ul>
<li><strong>CSV: comma separated values</strong> (this course will use this type the most)</li>
<li>TSV: tab separated values</li>
<li>FWF: fixed width file</li>
</ul>
<p>To load files, the <code>readr</code> package has the following functions:</p>
<ul>
<li><code>read_csv()</code>, <code>read_tsv()</code>, <code>read_delim()</code></li>
<li><code>read_fwf()</code>, <code>read_table()</code></li>
</ul>
</section>
<section id="read_csv-can-you-spot-the-differences" class="slide level2">
<h2><code>read_csv()</code>: can you spot the differences?</h2>
<!-- read.csv("~/Dropbox/Academic/Teaching/2025_Q2/sta141a/data/title.crew.csv") |> str() -->
<!-- read_csv("~/Dropbox/Academic/Teaching/2025_Q2/sta141a/data/title.crew.csv") |> str() -->
<!-- Assumes that the file "Medical_Cost.csv" is in the same folder that contains the R file that is executing `read_csv()`. -->
<!-- ::::: columns -->
<!-- ::: {.column width="50%"} -->
<!-- ```{r} -->
<!-- read.csv("networth.csv")  # from base R -->
<!-- ``` -->
<!-- ::: -->
<!-- ::: {.column width="50%"} -->
<!-- ```{r} -->
<!-- read_csv("networth.csv")  # from readr package -->
<!-- ``` -->
<!-- ::: -->
<!-- ::::: -->

<img data-src="networth.png" class="r-stretch quarto-figure-center"><p class="caption">networth.csv</p><div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a><span class="fu">read.csv</span>(<span class="st">"networth.csv"</span>)  <span class="co"># from utils package; preinstalled with R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  net.worth first.name last.name
1 4,738,029        Max Moneybags
2     5,430       Jane    Austen
3     6,549        Leo   Tolstoy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a><span class="fu">read_csv</span>(<span class="st">"networth.csv"</span>)  <span class="co"># from readr package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  `net worth` `first name` `last name`
        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      
1     4738029 Max          Moneybags  
2        5430 Jane         Austen     
3        6549 Leo          Tolstoy    </code></pre>
</div>
</div>
</section>
<section id="read_csv-can-you-spot-the-differences-1" class="slide level2">
<h2><code>read_csv()</code>: can you spot the differences?</h2>
<p>Column names can have spaces. How to access?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a>nw_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"networth.csv"</span>)</span>
<span id="cb16-2"><a href=""></a>nw_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  `net worth` `first name` `last name`
        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      
1     4738029 Max          Moneybags  
2        5430 Jane         Austen     
3        6549 Leo          Tolstoy    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a>nw_df<span class="sc">$</span><span class="st">`</span><span class="at">net worth</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 47380290    54300    65490</code></pre>
</div>
</div>
<p>You’ll likely want to use external files for your final project</p>
<ul>
<li>For lecture, mostly stick with datasets from base R or packages</li>
</ul>
</section></section>
<section>
<section id="subsetting-a-data-frame" class="title-slide slide level1 center">
<h1>Subsetting a data frame</h1>

</section>
<section id="subset-based-on-data-values-rather-than-rowcolumn-indices" class="slide level2">
<h2>Subset based on data values (rather than row/column indices)</h2>
<ul>
<li>Column: <code>select()</code></li>
<li>Row: <code>filter()</code></li>
</ul>
</section>
<section id="the-select-function" class="slide level2">
<h2>The <code>select()</code> function</h2>
<p>Returns a tibble with the columns specified, in order specified.</p>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href=""></a>flights <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href=""></a>  <span class="fu">select</span>(origin, dest, air_time, distance) <span class="sc">|&gt;</span>  <span class="co"># Do not need quotation marks.</span></span>
<span id="cb20-3"><a href=""></a>  <span class="fu">colnames</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "origin"   "dest"     "air_time" "distance"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href=""></a>flights <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href=""></a>  <span class="fu">select</span>(distance, dest, origin, air_time) <span class="sc">|&gt;</span>  <span class="co"># Do not need quotation marks.</span></span>
<span id="cb22-3"><a href=""></a>  <span class="fu">colnames</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "distance" "dest"     "origin"   "air_time"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a><span class="fu">colnames</span>(<span class="fu">select</span>(flights, distance, dest, origin, air_time))  <span class="co"># hard to read</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "distance" "dest"     "origin"   "air_time"</code></pre>
</div>
</div>
<!-- Helper functions for `select()`: -->
<!-- -    `starts_with("abc")`: matches names that begin with “abc”. -->
<!-- -    `ends_with("xyz")`: matches names that end with “xyz”. -->
<!-- -    `contains("ijk")`: matches names that contain “ijk”. -->
<!-- -    `num_range("x", 1:3)`: matches x1, x2 and x3. -->
</section>
<section id="helper-functions-for-select" class="slide level2">
<h2>Helper functions for <code>select()</code></h2>
<ul>
<li><code>starts_with("abc")</code>: matches names that begin with “abc”.</li>
<li><code>ends_with("xyz")</code>: matches names that end with “xyz”.</li>
<li><code>contains("ijk")</code>: matches names that contain “ijk”.</li>
</ul>
<div class="cell" data-output.lines="5">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href=""></a>flights <span class="sc">|&gt;</span> <span class="fu">colnames</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "year"           "month"          "day"            "dep_time"      
 [5] "sched_dep_time" "dep_delay"      "arr_time"       "sched_arr_time"
 [9] "arr_delay"      "carrier"        "flight"         "tailnum"       
[13] "origin"         "dest"           "air_time"       "distance"      
[17] "hour"           "minute"         "time_hour"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href=""></a>flights <span class="sc">|&gt;</span> <span class="fu">select</span>(origin, dest, <span class="fu">contains</span>(<span class="st">"sched"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 4
   origin dest  sched_dep_time sched_arr_time
   &lt;chr&gt;  &lt;chr&gt;          &lt;int&gt;          &lt;int&gt;
 1 EWR    IAH              515            819
 2 LGA    IAH              529            830
...</code></pre>
</div>
</div>
<!-- ::::: columns -->
<!-- ::: {.column width="60%"} -->
<!-- ```{r} -->
<!-- colnames(billboard) -->
<!-- ``` -->
<!-- ::: -->
<!-- ::: {.column width="40%"} -->
<!-- ```{r} -->
<!-- billboard |> -->
<!--   select(num_range("wk", 6:8)) -->
<!-- ``` -->
<!-- ::: -->
<!-- ::::: -->
<!-- ## The `select()` function -->
<!-- ```{r} -->
<!-- colnames(flights) -->
<!-- after_select <- flights %>% -->
<!--   select(time_hour, origin, dest, contains("sched")) -->
<!-- colnames(after_select) -->
<!-- ``` -->
</section>
<section id="the-filter-function" class="slide level2">
<h2>The <code>filter()</code> function</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href=""></a><span class="co"># data = data to filter</span></span>
<span id="cb30-2"><a href=""></a><span class="co"># expr&lt;#&gt; = expression used to filter data, typically using ==, &gt;, etc</span></span>
<span id="cb30-3"><a href=""></a><span class="fu">filter</span>(<span class="sc">&lt;</span>data<span class="sc">&gt;</span>, <span class="sc">&lt;</span>expr1<span class="sc">&gt;</span>)</span>
<span id="cb30-4"><a href=""></a><span class="fu">filter</span>(<span class="sc">&lt;</span>data<span class="sc">&gt;</span>, <span class="sc">&lt;</span>expr1<span class="sc">&gt;</span>, <span class="sc">&lt;</span>expr2<span class="sc">&gt;</span>, <span class="sc">&lt;</span>expr3<span class="sc">&gt;</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Example: flights on February 15</p>
<div class="cell" data-output.lines="8">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href=""></a><span class="fu">filter</span>(flights, month <span class="sc">==</span> <span class="dv">2</span>, day <span class="sc">==</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 954 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     2    15        3           2358         5      503            438
 2  2013     2    15        6           2115       171       48           2214
 3  2013     2    15        6           2250        76      117              5
 4  2013     2    15       22           2230       112      510            312
 5  2013     2    15       36           2352        44      607            437
...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href=""></a>flights <span class="sc">|&gt;</span> <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">2</span>, day <span class="sc">==</span> <span class="dv">15</span>)  <span class="co"># same as above</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-filter-function-1" class="slide level2">
<h2>The <code>filter()</code> function</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href=""></a><span class="co"># data = data to filter</span></span>
<span id="cb34-2"><a href=""></a><span class="co"># expr = expression used to filter data, typically using ==, &gt;, etc</span></span>
<span id="cb34-3"><a href=""></a><span class="fu">filter</span>(<span class="sc">&lt;</span>data<span class="sc">&gt;</span>, <span class="sc">&lt;</span>expr<span class="sc">&gt;</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Expressions can be built up using comparison operators and logical operators.</p>
<ul>
<li><code>&amp;</code> is “and”</li>
<li><code>|</code> is “or”</li>
<li><code>!</code> is “not”</li>
<li><code>%in%</code> is a membership checker (is an object inside of a vector)</li>
<li><code>&gt;</code>, <code>&lt;</code> mean greater than, less than</li>
<li><code>&gt;=</code>, <code>&lt;=</code> mean greater than or equal to, less than or requal to</li>
<li><code>==</code> means “is equal”</li>
<li><code>!=</code> means “is not equal”</li>
</ul>
</section>
<section id="examples-of-filter" class="slide level2">
<h2>Examples of <code>filter()</code></h2>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href=""></a>  <span class="fu">select</span>(time_hour, origin, dest, air_time, distance) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href=""></a>  <span class="fu">filter</span>(distance <span class="sc">&lt;</span> <span class="dv">120</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,076 × 5
   time_hour           origin dest  air_time distance
   &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 2013-01-01 09:00:00 LGA    PHL         32       96
 2 2013-01-01 13:00:00 EWR    BDL         25      116
 3 2013-01-01 16:00:00 JFK    PHL         35       94
...</code></pre>
</div>
</div>
<div class="cell" data-output.lines="5">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href=""></a>  <span class="fu">select</span>(time_hour, origin, dest, air_time, distance) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href=""></a>  <span class="fu">filter</span>(distance <span class="sc">&lt;</span> <span class="dv">120</span>, origin <span class="sc">==</span> <span class="st">'EWR'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 493 × 5
   time_hour           origin dest  air_time distance
   &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 2013-01-01 13:00:00 EWR    BDL         25      116
 2 2013-01-01 22:00:00 EWR    BDL         24      116
...</code></pre>
</div>
</div>
</section>
<section id="spot-the-error" class="slide level2">
<h2>Spot the error?</h2>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href=""></a>  <span class="fu">select</span>(origin, dest, air_time, distance) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href=""></a>  <span class="fu">filter</span>(origin <span class="sc">==</span> SFO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="spot-the-error-1" class="slide level2">
<h2>Spot the error?</h2>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href=""></a>  <span class="fu">select</span>(origin, dest, air_time, distance) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href=""></a>  <span class="fu">filter</span>(origin <span class="sc">==</span> <span class="st">'SFO'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="equivalent-ways-to-filter-on-multiple-conditions" class="slide level2">
<h2>Equivalent ways to filter on multiple conditions</h2>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href=""></a>  <span class="fu">select</span>(origin, dest, air_time, distance) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href=""></a>  <span class="fu">filter</span>(distance <span class="sc">&lt;</span> <span class="dv">120</span>, origin <span class="sc">==</span> <span class="st">"EWR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 493 × 4
   origin dest  air_time distance
   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 EWR    BDL         25      116
 2 EWR    BDL         24      116
 3 EWR    BDL         24      116
...</code></pre>
</div>
</div>
<div class="cell" data-output.lines="5">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href=""></a>  <span class="fu">select</span>(origin, dest, air_time, distance) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href=""></a>  <span class="fu">filter</span>(distance <span class="sc">&lt;</span> <span class="dv">120</span> <span class="sc">&amp;</span> origin <span class="sc">==</span> <span class="st">"EWR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-output.lines="5">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href=""></a>  <span class="fu">select</span>(origin, dest, air_time, distance) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href=""></a>  <span class="fu">filter</span>(distance <span class="sc">&lt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href=""></a>  <span class="fu">filter</span>(origin <span class="sc">==</span> <span class="st">"EWR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="inspect-a-data-frame" class="title-slide slide level1 center">
<h1>Inspect a data frame</h1>

</section>
<section id="count" class="slide level2">
<h2><code>count()</code></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>To count occurrences of different pairs/“tuples” of values across columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href=""></a>dataframe <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href=""></a>  <span class="fu">count</span>(column1, column2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>e.g.&nbsp;for flights, want to count how many flights by origin:</p>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href=""></a>  <span class="fu">count</span>(origin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  origin      n
  &lt;chr&gt;   &lt;int&gt;
1 EWR    120835
2 JFK    111279
3 LGA    104662</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Or how many origin-destination pairs:</p>
<div class="cell" data-output.lines="12">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href=""></a>  <span class="fu">count</span>(origin, dest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 3
   origin dest      n
   &lt;chr&gt;  &lt;chr&gt; &lt;int&gt;
 1 EWR    ALB     439
 2 EWR    ANC       8
 3 EWR    ATL    5022
 4 EWR    AUS     968
 5 EWR    AVL     265
 6 EWR    BDL     443
 7 EWR    BNA    2336
 8 EWR    BOS    5327
 9 EWR    BQN     297
...</code></pre>
</div>
</div>
</div></div>
</section>
<section id="count-1" class="slide level2">
<h2><code>count()</code></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>To count occurrences of different pairs/“tuples” of values across columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href=""></a>dataframe <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href=""></a>  <span class="fu">count</span>(column1, column2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>e.g.&nbsp;for flights, want to count how many flights by origin:</p>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href=""></a>  <span class="fu">count</span>(origin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  origin      n
  &lt;chr&gt;   &lt;int&gt;
1 EWR    120835
2 JFK    111279
3 LGA    104662</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Or how many origin-destination pairs:</p>
<div class="cell" data-output.lines="12">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href=""></a>  <span class="fu">count</span>(origin, dest, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 3
   origin dest      n
   &lt;chr&gt;  &lt;chr&gt; &lt;int&gt;
 1 JFK    LAX   11262
 2 LGA    ATL   10263
 3 LGA    ORD    8857
 4 JFK    SFO    8204
 5 LGA    CLT    6168
 6 EWR    ORD    6100
 7 JFK    BOS    5898
 8 LGA    MIA    5781
 9 JFK    MCO    5464
...</code></pre>
</div>
</div>
</div></div>
</section>
<section id="summary-statistics-and-missing-data" class="slide level2">
<h2>Summary statistics and missing data</h2>
<p>Common summary statistics of interest in data:</p>
<ul>
<li>Mean (<code>mean()</code>)</li>
<li>Min/max (<code>min()</code>, <code>max()</code>)</li>
<li>Median (<code>median()</code>)</li>
<li>Standard deviation / variance (<code>sd()</code>, <code>var()</code>)</li>
</ul>
<p>R denotes missing data using <code>NA</code>. Typically, if you compute a function of a vector with <code>NA</code>s, it will return <code>NA</code>, unless you put <code>na.rm=TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb55-2"><a href=""></a><span class="fu">mean</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href=""></a><span class="fu">mean</span>(x, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="summarise" class="slide level2">
<h2><code>summarise()</code></h2>
<p>If you want to compute summary statistics of dataframe, use <code>summarise()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href=""></a><span class="co"># data = data you want to create a new variable from</span></span>
<span id="cb59-2"><a href=""></a><span class="co"># new var name = the name your new variable will be</span></span>
<span id="cb59-3"><a href=""></a><span class="co"># calc exp = the calculation you want to perform</span></span>
<span id="cb59-4"><a href=""></a><span class="fu">summarise</span>(<span class="sc">&lt;</span>data<span class="sc">&gt;</span>, <span class="sc">&lt;</span>new var name<span class="sc">&gt;</span> <span class="er">=</span> <span class="er">&lt;</span>calc exp<span class="sc">&gt;</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-output.lines="5">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href=""></a>  <span class="fu">summarise</span>(<span class="at">avg_dist =</span> <span class="fu">mean</span>(distance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  avg_dist
     &lt;dbl&gt;
1    1040.</code></pre>
</div>
</div>
</section>
<section id="summarize" class="slide level2">
<h2><code>summarize()</code></h2>
<p>If you want to compute summary statistics of dataframe, use <code>summarize()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href=""></a><span class="co"># data = data you want to create a new variable from</span></span>
<span id="cb62-2"><a href=""></a><span class="co"># new var name = the name your new variable will be</span></span>
<span id="cb62-3"><a href=""></a><span class="co"># calc exp = the calculation you want to perform</span></span>
<span id="cb62-4"><a href=""></a><span class="fu">summarize</span>(<span class="sc">&lt;</span>data<span class="sc">&gt;</span>, <span class="sc">&lt;</span>new var name<span class="sc">&gt;</span> <span class="er">=</span> <span class="er">&lt;</span>calc exp<span class="sc">&gt;</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-output.lines="5">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">avg_dist =</span> <span class="fu">mean</span>(distance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  avg_dist
     &lt;dbl&gt;
1    1040.</code></pre>
</div>
</div>
</section>
<section id="group_by-and-summarise" class="slide level2">
<h2><code>group_by()</code> and <code>summarise()</code></h2>
<p>To compute summary statistics per category, use <code>group_by()</code> first.</p>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href=""></a>  <span class="fu">group_by</span>(origin) <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">median_distance =</span> <span class="fu">median</span>(distance, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb65-4"><a href=""></a>            <span class="at">max_air_time =</span> <span class="fu">max</span>(air_time, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  origin median_distance max_air_time
  &lt;chr&gt;            &lt;dbl&gt;        &lt;dbl&gt;
1 EWR                872          695
2 JFK               1069          691
3 LGA                762          331</code></pre>
</div>
</div>
</section>
<section id="mutate" class="slide level2">
<h2><code>mutate()</code></h2>
<p><code>mutate()</code> adds new columns to the data frame using functions of extant columns.</p>
<div class="cell" data-output.lines="9">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href=""></a>  <span class="fu">select</span>(origin, dest, air_time, distance, air_time) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">hours =</span> air_time <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb67-4"><a href=""></a>         <span class="at">mi_per_hour =</span> distance <span class="sc">/</span> hours, </span>
<span id="cb67-5"><a href=""></a>         <span class="at">km_per_hour =</span> <span class="fl">1.61</span> <span class="sc">*</span> mi_per_hour)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 7
   origin dest  air_time distance hours mi_per_hour km_per_hour
   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 EWR    IAH        227     1400 3.78         370.        596.
 2 LGA    IAH        227     1416 3.78         374.        603.
 3 JFK    MIA        160     1089 2.67         408.        657.
 4 JFK    BQN        183     1576 3.05         517.        832.
 5 LGA    ATL        116      762 1.93         394.        635.
 6 EWR    ORD        150      719 2.5          288.        463.
...</code></pre>
</div>
</div>
<p><code>mi_per_hour</code> uses <code>hours</code>, which was created within the same <code>mutate()</code> call.</p>
</section></section>
<section>
<section id="reshaping-a-data-frame" class="title-slide slide level1 center">
<h1>Reshaping a data frame</h1>

</section>
<section id="tidy-data" class="slide level2">
<h2>Tidy data</h2>
<p>Multiple equivalent ways of organizing data into a dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href=""></a>table1</span>
<span id="cb69-2"><a href=""></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb69-3"><a href=""></a><span class="co">#&gt;   country      year  cases population</span></span>
<span id="cb69-4"><a href=""></a><span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb69-5"><a href=""></a><span class="co">#&gt; 1 Afghanistan  1999    745   19987071</span></span>
<span id="cb69-6"><a href=""></a><span class="co">#&gt; 2 Afghanistan  2000   2666   20595360</span></span>
<span id="cb69-7"><a href=""></a><span class="co">#&gt; 3 Brazil       1999  37737  172006362</span></span>
<span id="cb69-8"><a href=""></a><span class="co">#&gt; 4 Brazil       2000  80488  174504898</span></span>
<span id="cb69-9"><a href=""></a><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span id="cb69-10"><a href=""></a><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span>
<span id="cb69-11"><a href=""></a></span>
<span id="cb69-12"><a href=""></a>table2</span>
<span id="cb69-13"><a href=""></a><span class="co">#&gt; # A tibble: 12 × 4</span></span>
<span id="cb69-14"><a href=""></a><span class="co">#&gt;   country      year type           count</span></span>
<span id="cb69-15"><a href=""></a><span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb69-16"><a href=""></a><span class="co">#&gt; 1 Afghanistan  1999 cases            745</span></span>
<span id="cb69-17"><a href=""></a><span class="co">#&gt; 2 Afghanistan  1999 population  19987071</span></span>
<span id="cb69-18"><a href=""></a><span class="co">#&gt; 3 Afghanistan  2000 cases           2666</span></span>
<span id="cb69-19"><a href=""></a><span class="co">#&gt; 4 Afghanistan  2000 population  20595360</span></span>
<span id="cb69-20"><a href=""></a><span class="co">#&gt; 5 Brazil       1999 cases          37737</span></span>
<span id="cb69-21"><a href=""></a><span class="co">#&gt; 6 Brazil       1999 population 172006362</span></span>
<span id="cb69-22"><a href=""></a><span class="co">#&gt; # ℹ 6 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>table1 is <strong>tidy</strong> - easier to work with using <code>tidyverse</code>.</p>
</section>
<section id="tidy-data-1" class="slide level2">
<h2>Tidy data</h2>
<ul>
<li>Each variable is a column; each column is a variable.</li>
<li>Each observation is a row; each row is an observation.</li>
<li>Each value is a cell; each cell is a single value.</li>
</ul>

<img data-src="tidy.png" class="r-stretch quarto-figure-center"><p class="caption">Tidy data</p><p>Why tidy data?</p>
<ul>
<li>Consistency - uniform format makes collaboration easier</li>
<li>Vectorization - R commands often operate on vectors of data, best for each column to be a vector of data</li>
</ul>
</section>
<section id="tidying-data" class="slide level2">
<h2><strong>Tidying</strong> data</h2>
<p>Unfortunately, most real-world datasets you encounter are NOT tidy.</p>
<ul>
<li>A large part of “data scientist work” consists in tidying data (“cleaning data”).</li>
</ul>
<!-- The next two weeks will primarily be about how to tidy/rearrange data so -->
<!-- that you can do data analysis and visualization properly. -->
<div class="cell" data-output.lines="10">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href=""></a>billboard</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 79
   artist     track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
   &lt;chr&gt;      &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 2 Pac      Baby… 2000-02-26      87    82    72    77    87    94    99    NA
 2 2Ge+her    The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA
 3 3 Doors D… Kryp… 2000-04-08      81    70    68    67    66    57    54    53
 4 3 Doors D… Loser 2000-10-21      76    76    72    69    67    65    55    59
 5 504 Boyz   Wobb… 2000-04-15      57    34    25    17    17    31    36    49
 6 98^0       Give… 2000-08-19      51    39    34    26    26    19     2     2
 7 A*Teens    Danc… 2000-07-08      97    97    96    95   100    NA    NA    NA
...</code></pre>
</div>
</div>
</section>
<section id="lengthening-data-with-pivot_longer" class="slide level2">
<h2>Lengthening data with <code>pivot_longer()</code></h2>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href=""></a>billboard</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 79
   artist     track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
   &lt;chr&gt;      &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 2 Pac      Baby… 2000-02-26      87    82    72    77    87    94    99    NA
 2 2Ge+her    The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA
 3 3 Doors D… Kryp… 2000-04-08      81    70    68    67    66    57    54    53
...</code></pre>
</div>
</div>
<!-- Billboard dataset:  -->
<ul>
<li>Each observation is a song.</li>
<li>First three columns (<code>artist</code>, <code>track</code>, <code>date.entered</code>) describe the song.</li>
<li>The next 76 columns (<code>wk1</code>, <code>wk2</code>, …, <code>wk76</code>) say song’s rank in each week.</li>
<li>But week should be a <em>variable</em>.</li>
<li>Each observation should be <code>artist-track-date.entered-week-rank</code>.</li>
<li>To make it tidy, each observation should be a row. Need to make the dataframe longer.</li>
</ul>
<!-- - The column names (`week`) are actually a *variable*, while the cell values are another variable (the `rank`) -->
</section>
<section id="lengthening-data-with-pivot_longer-1" class="slide level2">
<h2>Lengthening data with <code>pivot_longer()</code></h2>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href=""></a>billboard <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href=""></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb74-3"><a href=""></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"wk"</span>),  <span class="co"># `cols`: which columns need to be pivoted</span></span>
<span id="cb74-4"><a href=""></a>    <span class="at">names_to =</span> <span class="st">"week"</span>,  <span class="co"># `names_to`: name of the column that the pivoted column names go</span></span>
<span id="cb74-5"><a href=""></a>    <span class="at">values_to =</span> <span class="st">"rank"</span>  <span class="co"># `values_to`: name of the column that the pivoted cell values go</span></span>
<span id="cb74-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24,092 × 5
   artist track                   date.entered week   rank
   &lt;chr&gt;  &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87
 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82
 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72
 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77
...</code></pre>
</div>
</div>
<!-- - `cols` specifies which columns need to be pivoted -->
<!-- - `names_to` names the variable stored in the column names ("week") -->
<!-- - `values_to` names the variable stored in cell values ("rank") -->
<ul>
<li>“week” and “rank” do not appear as column names in billboard, so need quotes</li>
</ul>
<!-- ## Lengthening data with `pivot_longer()` -->
<!-- ::::: columns -->
<!-- ::: {.column width="50%"} -->
<!-- ```{r, output.lines=7} -->
<!-- billboard %>% -->
<!--   pivot_longer( -->
<!--     cols = starts_with("wk"), -->
<!--     names_to = "week", -->
<!--     values_to = "rank" -->
<!--   ) -->
<!-- ``` -->
<!-- ::: -->
<!-- ::: {.column width="50%"} -->
<!-- - `cols` specifies which columns need to be pivoted (= are NOT variables) -->
<!-- - `names_to` names the variable stored in the column names ("week") -->
<!-- - `values_to` names the variable stored in cell values ("rank") -->
<!-- - "week" and "rank" do not appear as column names in billboard, so need quotes -->
<!-- ::: -->
<!-- ::::: -->
</section>
<section id="lengthening-data-with-pivot_longer-2" class="slide level2">
<h2>Lengthening data with <code>pivot_longer()</code></h2>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href=""></a>billboard <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href=""></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb76-3"><a href=""></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"wk"</span>),  <span class="co"># `cols`: which columns need to be pivoted</span></span>
<span id="cb76-4"><a href=""></a>    <span class="at">names_to =</span> <span class="st">"week"</span>,  <span class="co"># `names_to`: name of the column that the pivoted column names go</span></span>
<span id="cb76-5"><a href=""></a>    <span class="at">values_to =</span> <span class="st">"rank"</span>  <span class="co"># `values_to`: name of the column that the pivoted cell values go</span></span>
<span id="cb76-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24,092 × 5
   artist track                   date.entered week   rank
   &lt;chr&gt;  &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87
 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82
 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72
 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77
...</code></pre>
</div>
</div>
<p>Data is now tidy, but not ideal for data analysis. Why?</p>
<ul>
<li><code>week</code> should ideally be a number, not a character</li>
<li>Can use <code>readr::parse_number()</code> that extracts first number from string to fix.</li>
</ul>
</section>
<section id="lengthening-data-with-pivot_longer-3" class="slide level2">
<h2>Lengthening data with <code>pivot_longer()</code></h2>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href=""></a>billboard <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href=""></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb78-3"><a href=""></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"wk"</span>),</span>
<span id="cb78-4"><a href=""></a>    <span class="at">names_to =</span> <span class="st">"week"</span>,</span>
<span id="cb78-5"><a href=""></a>    <span class="at">values_to =</span> <span class="st">"rank"</span></span>
<span id="cb78-6"><a href=""></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb78-7"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">parse_number</span>(week))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24,092 × 5
   artist track                   date.entered  week  rank
   &lt;chr&gt;  &lt;chr&gt;                   &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt;
 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26       1    87
 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26       2    82
 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26       3    72
 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26       4    77
...</code></pre>
</div>
</div>
</section>
<section id="understanding-pivot_longer" class="slide level2">
<h2>Understanding <code>pivot_longer()</code></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Consider toy dataset: three people (A, B, C) each with two blood pressure (BP) measurements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href=""></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb80-2"><a href=""></a>  <span class="sc">~</span>id,  <span class="sc">~</span>bp1, <span class="sc">~</span>bp2,</span>
<span id="cb80-3"><a href=""></a>   <span class="st">"A"</span>,  <span class="dv">100</span>,  <span class="dv">120</span>,</span>
<span id="cb80-4"><a href=""></a>   <span class="st">"B"</span>,  <span class="dv">140</span>,  <span class="dv">115</span>,</span>
<span id="cb80-5"><a href=""></a>   <span class="st">"C"</span>,  <span class="dv">120</span>,  <span class="dv">125</span></span>
<span id="cb80-6"><a href=""></a>)</span>
<span id="cb80-7"><a href=""></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  id      bp1   bp2
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 A       100   120
2 B       140   115
3 C       120   125</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Want each observation (id, bp) to have its own row:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href=""></a>df <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href=""></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb82-3"><a href=""></a>    <span class="at">cols =</span> <span class="fu">c</span>(bp1, bp2),</span>
<span id="cb82-4"><a href=""></a>    <span class="at">names_to =</span> <span class="st">"measurement"</span>,</span>
<span id="cb82-5"><a href=""></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb82-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  id    measurement value
  &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;
1 A     bp1           100
2 A     bp2           120
3 B     bp1           140
4 B     bp2           115
5 C     bp1           120
6 C     bp2           125</code></pre>
</div>
</div>
</div></div>
</section>
<section id="understanding-pivot_longer-1" class="slide level2">
<h2>Understanding <code>pivot_longer()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href=""></a>df <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href=""></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb84-3"><a href=""></a>    <span class="at">cols =</span> <span class="fu">c</span>(bp1, bp2),  <span class="co"># which columns need to be pivoted</span></span>
<span id="cb84-4"><a href=""></a>    <span class="at">names_to =</span> <span class="st">"measurement"</span>,  <span class="co"># name of the column that the pivoted column names go</span></span>
<span id="cb84-5"><a href=""></a>    <span class="at">values_to =</span> <span class="st">"value"</span>  <span class="co"># name of the column that the pivoted cell values go</span></span>
<span id="cb84-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="variables.png" style="width:50.0%" class="r-stretch quarto-figure-center"><p class="caption">Values in columns that are already variables (here, <code>id</code>) need to be repeated for each pivoted column.</p></section>
<section id="understanding-pivot_longer-2" class="slide level2">
<h2>Understanding <code>pivot_longer()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href=""></a>df <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href=""></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb85-3"><a href=""></a>    <span class="at">cols =</span> <span class="fu">c</span>(bp1, bp2),  <span class="co"># which columns need to be pivoted</span></span>
<span id="cb85-4"><a href=""></a>    <span class="at">names_to =</span> <span class="st">"measurement"</span>,  <span class="co"># name of the column that the pivoted column names go</span></span>
<span id="cb85-5"><a href=""></a>    <span class="at">values_to =</span> <span class="st">"value"</span>  <span class="co"># name of the column that the pivoted cell values go</span></span>
<span id="cb85-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="column-names.png" style="width:50.0%" class="r-stretch quarto-figure-center"><p class="caption">Pivoted column names <code>bp1,bp2</code> become values in new column <code>"measurement"</code>; values repeated for each row in <code>df</code>.</p></section>
<section id="understanding-pivot_longer-3" class="slide level2">
<h2>Understanding <code>pivot_longer()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href=""></a>df <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href=""></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb86-3"><a href=""></a>    <span class="at">cols =</span> <span class="fu">c</span>(bp1, bp2),  <span class="co"># which columns need to be pivoted</span></span>
<span id="cb86-4"><a href=""></a>    <span class="at">names_to =</span> <span class="st">"measurement"</span>,  <span class="co"># name of the column that the pivoted column names go</span></span>
<span id="cb86-5"><a href=""></a>    <span class="at">values_to =</span> <span class="st">"value"</span>  <span class="co"># name of the column that the pivoted cell values go</span></span>
<span id="cb86-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<!-- ## Understanding pivoting -->
<!-- ```{r, eval=FALSE} -->
<!-- df %>% -->
<!--   pivot_longer( -->
<!--     cols = c(bp1, bp2),  # which columns need to be pivoted -->
<!--     names_to = "measurement",  # name of the column that the pivoted column names go -->
<!--     values_to = "value"  # name of the column that the pivoted cell values go -->
<!--   ) -->
<!-- ``` -->
<!-- ::: panel-tabset -->
<!-- ## qwer -->
<!-- ![Columns that are already variables need to be repeated for each pivoted column.](variables.png){width=50%} -->
<!-- ## asdf -->
<!-- ![Pivoted column names `bp1,bp2` become values in a new variable `"measurement"`, with name given by `names_to`. They need to be repeated for each row in the original dataset.](column-names.png){width=50%} -->
<!-- ## zxcv -->
<!-- ![Cell values are values in a new variable, with name `values_to`, unwound row by row.](cell-values.png){width=50%} -->
<!-- <!-- ![Cell values become new variable, with name given by values_to](cell-values.png){width=50%} -->
<!-- ::: -->
<!-- ## Understanding pivoting -->
<!-- ::::: columns -->
<!-- ::: {.column width="50%"} -->
<!-- ```{r, eval=FALSE} -->
<!-- df %>% -->
<!--   pivot_longer( -->
<!--     cols = c(bp1, bp2),  # which columns need to be pivoted -->
<!--     names_to = "measurement",  # name of the column that the pivoted column names go -->
<!--     values_to = "value"  # name of the column that the pivoted cell values go -->
<!--   ) -->
<!-- ``` -->
<!-- ![Columns that are already variables need to be repeated for each pivoted column.](variables.png) -->
<!-- ::: -->
<!-- ::: {.column width="50%"} -->
<!-- ![Pivoted column names `bp1,bp2` become values in a new variable `"measurement"`, with name given by `names_to`. They need to be repeated for each row in the original dataset.](column-names.png) -->
<!-- ![Cell values become new variable, with name given by values_to](cell-values.png) -->
<!-- Cell values are values in a new variable, with name `values_to`, unwound row by row. -->
<!-- ::: -->
<!-- ::::: -->
<img data-src="cell-values.png" style="width:50.0%" class="r-stretch quarto-figure-center"><p class="caption">Cell values are values in a new variable, with name <code>values_to</code>, unwound row by row.</p></section>
<section id="widening-data" class="slide level2">
<h2>Widening data</h2>
<p>We’ll now use <code>pivot_wider()</code> to widen data which is (too) long.</p>
<div class="cell" data-output.lines="10">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href=""></a>cms_patient_experience <span class="ot">&lt;-</span> tidyr<span class="sc">::</span>cms_patient_experience <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href=""></a>   <span class="fu">select</span>(<span class="sc">-</span>measure_title)</span>
<span id="cb87-3"><a href=""></a>cms_patient_experience</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 500 × 4
   org_pac_id org_nm                               measure_cd   prf_rate
   &lt;chr&gt;      &lt;chr&gt;                                &lt;chr&gt;           &lt;dbl&gt;
 1 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_1        63
 2 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_2        87
 3 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_3        86
 4 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_5        57
 5 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_8        85
 6 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_12       24
 7 0446162697 ASSOCIATION OF UNIVERSITY PHYSICIANS CAHPS_GRP_1        59
...</code></pre>
</div>
</div>
<p>The basic unit studied is an organization, but it’s spread across six rows for different measurements.</p>
</section>
<section id="widening-data-1" class="slide level2">
<h2>Widening data</h2>
<div class="cell" data-output.lines="9">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href=""></a>cms_patient_experience <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href=""></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb89-3"><a href=""></a>    <span class="at">id_cols =</span> <span class="fu">starts_with</span>(<span class="st">"org"</span>), <span class="co"># org_pac_id and org_nm are identifiers</span></span>
<span id="cb89-4"><a href=""></a>    <span class="at">names_from =</span> measure_cd,</span>
<span id="cb89-5"><a href=""></a>    <span class="at">values_from =</span> prf_rate</span>
<span id="cb89-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 95 × 8
   org_pac_id org_nm CAHPS_GRP_1 CAHPS_GRP_2 CAHPS_GRP_3 CAHPS_GRP_5 CAHPS_GRP_8
   &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 0446157747 USC C…          63          87          86          57          85
 2 0446162697 ASSOC…          59          85          83          63          88
 3 0547164295 BEAVE…          49          NA          75          44          73
 4 0749333730 CAPE …          67          84          85          65          82
 5 0840104360 ALLIA…          66          87          87          64          87
 6 0840109864 REX H…          73          87          84          67          91
...</code></pre>
</div>
</div>
<p>If you don’t supply <code>id_cols</code>, R assumes that all columns EXCEPT for <code>names_from</code> and <code>values_from</code> are id_cols.</p>
</section>
<section id="understanding-pivot_wider" class="slide level2">
<h2>Understanding <code>pivot_wider()</code></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Dataset where two patients (A, B), with between 2 and 3 BP measurements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href=""></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  id    measurement value
  &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;
1 A     bp1           100
2 B     bp1           140
3 B     bp2           115
4 A     bp2           120
5 A     bp3           105</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href=""></a>df <span class="sc">%&gt;%</span></span>
<span id="cb93-2"><a href=""></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb93-3"><a href=""></a>    <span class="at">names_from =</span> measurement,</span>
<span id="cb93-4"><a href=""></a>    <span class="at">values_from =</span> value</span>
<span id="cb93-5"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  id      bp1   bp2   bp3
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 A       100   120   105
2 B       140   115    NA</code></pre>
</div>
</div>
<ul>
<li>There is no measurement for bp3 for B, so R puts in <code>NA</code>.</li>
<li><code>id_cols</code> is empty, so R assumes that all columns EXCEPT for <code>names_from</code> and <code>values_from</code> are id_cols.</li>
</ul>
</div></div>
</section>
<section id="going-from-long-to-wide-and-back-again" class="slide level2">
<h2>Going from long to wide and back again</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href=""></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  id    measurement value
  &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;
1 A     bp1           100
2 B     bp1           140
3 B     bp2           115
4 A     bp2           120
5 A     bp3           105</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href=""></a>(wide_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href=""></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb97-3"><a href=""></a>    <span class="at">names_from =</span> measurement,</span>
<span id="cb97-4"><a href=""></a>    <span class="at">values_from =</span> value</span>
<span id="cb97-5"><a href=""></a>  ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  id      bp1   bp2   bp3
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 A       100   120   105
2 B       140   115    NA</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href=""></a>(long_df <span class="ot">&lt;-</span> wide_df <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href=""></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb99-3"><a href=""></a>      <span class="at">cols =</span> <span class="fu">c</span>(bp1, bp2, bp3),</span>
<span id="cb99-4"><a href=""></a>      <span class="at">names_to =</span> <span class="st">"measurement"</span>,</span>
<span id="cb99-5"><a href=""></a>      <span class="at">values_to =</span> <span class="st">"value"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  id    measurement value
  &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;
1 A     bp1           100
2 A     bp2           120
3 A     bp3           105
4 B     bp1           140
5 B     bp2           115
6 B     bp3            NA</code></pre>
</div>
</div>
<p>We now have an additional row to account for the <code>NA</code>.</p>
</div></div>
<!-- ## Tidy check -->
<!-- ::::: columns -->
<!-- ::: {.column width="50%"} -->
<!-- Make the table wider. -->
<!-- ```{r, echo = FALSE} -->
<!-- df <- tibble( -->
<!--   City = c("CityA", "CityA", "CityA", "CityA", "CityB", "CityB", "CityB", "CityB"), -->
<!--   Date = c("2024-01-01", "2024-01-01", "2024-01-02", "2024-01-02", "2024-01-01", "2024-01-01", "2024-01-02", "2024-01-02"), -->
<!--   Measurement = c("Temperature", "Humidity", "Temperature", "Humidity", "Temperature", "Humidity", "Temperature", "Humidity"), -->
<!--   Value = c(20, 80, 22, 82, 18, 85, 19, 88) -->
<!-- ) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- df -->
<!-- ``` -->
<!-- Not tidy, since each variable is not a column, e.g. temperature/humidity. -->
<!-- "Tidyness" can be a bit ambiguous, but if a column has different units (e.g., degrees vs. % humidity), likely not tidy. -->
<!-- ::: -->
</section>
<section id="tidy-check" class="slide level2">
<h2>Tidy check</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href=""></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
  City  Date       Measurement Value
  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;
1 CityA 2024-01-01 Temperature    20
2 CityA 2024-01-01 Humidity       80
3 CityA 2024-01-02 Temperature    22
4 CityA 2024-01-02 Humidity       82
5 CityB 2024-01-01 Temperature    18
6 CityB 2024-01-01 Humidity       85
7 CityB 2024-01-02 Temperature    19
8 CityB 2024-01-02 Humidity       88</code></pre>
</div>
</div>
<ul>
<li>Not tidy, since each variable is not a column, e.g. temperature/humidity.</li>
<li>“Tidyness” can be a bit ambiguous, but if a column has different units (e.g., degrees vs.&nbsp;% humidity), likely not tidy.</li>
<li>Q: <strong>How do we make the table wider?</strong></li>
</ul>
</section>
<section id="tidy-check-1" class="slide level2">
<h2>Tidy check</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href=""></a>df <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href=""></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb103-3"><a href=""></a>    <span class="at">names_from =</span> Measurement,</span>
<span id="cb103-4"><a href=""></a>    <span class="at">values_from =</span> Value</span>
<span id="cb103-5"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  City  Date       Temperature Humidity
  &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt;
1 CityA 2024-01-01          20       80
2 CityA 2024-01-02          22       82
3 CityB 2024-01-01          18       85
4 CityB 2024-01-02          19       88</code></pre>
</div>
</div>
</section>
<section id="tidy-check-2" class="slide level2">
<h2>Tidy check</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href=""></a>scores</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Student  Math  Chem
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 Alice      85    90
2 Bob        92    78
3 Charlie    88    95</code></pre>
</div>
</div>
<p>Make <code>scores</code> longer by having a column called Subject with values <code>"Math"</code> and <code>"Chem"</code>.</p>
<ul>
<li>Q: <strong>Is the following code correct?</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href=""></a>scores <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href=""></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb107-3"><a href=""></a>    <span class="at">cols =</span> <span class="fu">c</span>(Math, Chem),</span>
<span id="cb107-4"><a href=""></a>    <span class="at">names_to =</span> Subject,</span>
<span id="cb107-5"><a href=""></a>    <span class="at">values_to =</span> Score</span>
<span id="cb107-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column fragment" style="width:40%;">
<p>No: <code>scores</code> tries to refer to <code>Subject</code> and <code>Score</code> which are not columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href=""></a>scores <span class="sc">%&gt;%</span></span>
<span id="cb108-2"><a href=""></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb108-3"><a href=""></a>    <span class="at">cols =</span> <span class="fu">c</span>(Math, Chem),</span>
<span id="cb108-4"><a href=""></a>    <span class="at">names_to =</span> <span class="st">"Subject"</span>,</span>
<span id="cb108-5"><a href=""></a>    <span class="at">values_to =</span> <span class="st">"Score"</span></span>
<span id="cb108-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Student Subject Score
  &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;
1 Alice   Math       85
2 Alice   Chem       90
3 Bob     Math       92
4 Bob     Chem       78
5 Charlie Math       88
6 Charlie Chem       95</code></pre>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="complex-calculations" class="title-slide slide level1 center">
<h1>Complex calculations</h1>

</section>
<section id="complex-calculations-1" class="slide level2">
<h2>Complex calculations</h2>
<p>Q: <strong>For each origin airport, compute the average flight time, in hours, for flights over 500 miles long.</strong></p>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href=""></a><span class="fu">colnames</span>(flights)  <span class="co"># hint: use origin, air_time, distance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "year"           "month"          "day"            "dep_time"      
 [5] "sched_dep_time" "dep_delay"      "arr_time"       "sched_arr_time"
 [9] "arr_delay"      "carrier"        "flight"         "tailnum"       
[13] "origin"         "dest"           "air_time"       "distance"      
[17] "hour"           "minute"         "time_hour"     </code></pre>
</div>
</div>
</section>
<section id="complex-calculations-2" class="slide level2">
<h2>Complex calculations</h2>
<p>Q: <strong>For each origin airport, compute the average flight time, in hours, for flights over 500 miles long.</strong></p>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb112-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">air_time_hrs =</span> air_time <span class="sc">/</span> <span class="dv">60</span>) <span class="sc">%&gt;%</span></span>
<span id="cb112-3"><a href=""></a>  <span class="fu">filter</span>(distance <span class="sc">&gt;</span> <span class="dv">500</span>) <span class="sc">%&gt;%</span></span>
<span id="cb112-4"><a href=""></a>  <span class="fu">group_by</span>(origin) <span class="sc">%&gt;%</span></span>
<span id="cb112-5"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">avg_flight_time_hrs =</span> <span class="fu">mean</span>(air_time_hrs, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  origin avg_flight_time_hrs
  &lt;chr&gt;                &lt;dbl&gt;
1 EWR                   2.99
2 JFK                   3.76
3 LGA                   2.27</code></pre>
</div>
</div>
</section>
<section id="complex-calculations-3" class="slide level2">
<h2>Complex calculations</h2>
<p>Q: <strong>For each origin airport, compute the average flight time, in hours, for flights over 500 miles long vs.&nbsp;less than or equal to 500 miles long.</strong></p>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href=""></a><span class="fu">colnames</span>(flights)  <span class="co"># hint: use origin, air_time, distance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "year"           "month"          "day"            "dep_time"      
 [5] "sched_dep_time" "dep_delay"      "arr_time"       "sched_arr_time"
 [9] "arr_delay"      "carrier"        "flight"         "tailnum"       
[13] "origin"         "dest"           "air_time"       "distance"      
[17] "hour"           "minute"         "time_hour"     </code></pre>
</div>
</div>
</section>
<section id="complex-calculations-4" class="slide level2">
<h2>Complex calculations</h2>
<p>Q: <strong>For each origin airport, compute the average flight time, in hours, for flights over 500 miles long vs.&nbsp;less than or equal to 500 miles long.</strong></p>
<!-- Average flight time, in minutes, per origin airport, when flight is \> 500 miles long vs. \<= 500 miles long? -->
<p>We will need to <code>group_by()</code> two variables:</p>
<ol type="1">
<li>origin airport</li>
<li>whether flight is <span class="math inline">\(&gt; 500\)</span> or <span class="math inline">\(\leq 500\)</span> miles. (We need to create this variable.)</li>
</ol>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href=""></a>  <span class="fu">select</span>(origin, air_time, distance) <span class="sc">%&gt;%</span>  <span class="co"># for visual clarity, not actually needed</span></span>
<span id="cb116-3"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">air_time_hrs =</span> air_time <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb116-4"><a href=""></a>         <span class="at">distance_greater_500mi =</span> distance <span class="sc">&gt;</span> <span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 5
   origin air_time distance air_time_hrs distance_greater_500mi
   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt; &lt;lgl&gt;                 
 1 EWR         227     1400        3.78  TRUE                  
 2 LGA         227     1416        3.78  TRUE                  
 3 JFK         160     1089        2.67  TRUE                  
 4 JFK         183     1576        3.05  TRUE                  
...</code></pre>
</div>
</div>
</section>
<section id="complex-calculations-5" class="slide level2">
<h2>Complex calculations</h2>
<p>Q: <strong>For each origin airport, compute the average flight time, in hours, for flights over 500 miles long vs.&nbsp;less than or equal to 500 miles long.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">air_time_hrs =</span> air_time <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb118-3"><a href=""></a>         <span class="at">distance_greater_500mi =</span> distance <span class="sc">&gt;</span> <span class="dv">500</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-4"><a href=""></a>  <span class="fu">group_by</span>(origin, distance_greater_500mi) <span class="sc">%&gt;%</span></span>
<span id="cb118-5"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">avg_flight_time_hrs =</span> <span class="fu">mean</span>(air_time_hrs, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   origin [3]
  origin distance_greater_500mi avg_flight_time_hrs
  &lt;chr&gt;  &lt;lgl&gt;                                &lt;dbl&gt;
1 EWR    FALSE                                0.900
2 EWR    TRUE                                 2.99 
3 JFK    FALSE                                0.849
4 JFK    TRUE                                 3.76 
5 LGA    FALSE                                0.916
6 LGA    TRUE                                 2.27 </code></pre>
</div>
</div>
</section></section>
<section>
<section id="operating-on-logical-vectors" class="title-slide slide level1 center">
<h1>Operating on logical vectors</h1>

</section>
<section id="intro" class="slide level2">
<h2>Intro</h2>
<p>For logical vectors, every element takes one of 3 values: <code>TRUE</code>, <code>FALSE</code>, <code>NA</code></p>
<p>We’ll investigate how to manipulate and transform data to get logicals, and how to use logicals.</p>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href=""></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb120-2"><a href=""></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb120-3"><a href=""></a>flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
...</code></pre>
</div>
</div>
</section>
<section id="three-basic-logical-operators-that-we-will-use-over-and-over" class="slide level2">
<h2>Three basic logical operators that we will use over and over:</h2>
<ul>
<li>AND (denoted <code>&amp;</code> in R): operation between two logicals</li>
<li>OR (denoted <code>|</code> in R): operation between two logicals</li>
<li>NOT (denoted <code>!</code> in R): operation on a single logical.</li>
</ul>
<div class="columns">
<div class="column" style="width:36%;">
<p>Truth table for AND:</p>
<table class="caption-top">
<thead>
<tr class="header">
<th>A</th>
<th>B</th>
<th>A <code>&amp;</code> B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>TRUE</code></td>
<td><code>TRUE</code></td>
<td><code>TRUE</code></td>
</tr>
<tr class="even">
<td><code>TRUE</code></td>
<td><code>FALSE</code></td>
<td><code>FALSE</code></td>
</tr>
<tr class="odd">
<td><code>FALSE</code></td>
<td><code>TRUE</code></td>
<td><code>FALSE</code></td>
</tr>
<tr class="even">
<td><code>FALSE</code></td>
<td><code>FALSE</code></td>
<td><code>FALSE</code></td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:36%;">
<p>Truth table for OR:</p>
<table class="caption-top">
<thead>
<tr class="header">
<th>A</th>
<th>B</th>
<th>A <code>|</code> B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>TRUE</code></td>
<td><code>TRUE</code></td>
<td><code>TRUE</code></td>
</tr>
<tr class="even">
<td><code>TRUE</code></td>
<td><code>FALSE</code></td>
<td><code>TRUE</code></td>
</tr>
<tr class="odd">
<td><code>FALSE</code></td>
<td><code>TRUE</code></td>
<td><code>TRUE</code></td>
</tr>
<tr class="even">
<td><code>FALSE</code></td>
<td><code>FALSE</code></td>
<td><code>FALSE</code></td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:28%;">
<p>Truth table for NOT:</p>
<table class="caption-top">
<thead>
<tr class="header">
<th>A</th>
<th><code>!</code> A</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>TRUE</code></td>
<td><code>FALSE</code></td>
</tr>
<tr class="even">
<td><code>FALSE</code></td>
<td><code>TRUE</code></td>
</tr>
</tbody>
</table>
</div></div>
<p><strong>Can combine AND/OR with NOT to cover any binary Boolean operation</strong></p>
</section>
<section id="comparisons" class="slide level2">
<h2>Comparisons</h2>
<p>Common way to create a logical vector: numeric comparison with <code>&lt;</code>, <code>!=</code>, etc.</p>
<p>We have implicitly been using this when doing filtering.</p>
<div class="cell" data-output.lines="2">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href=""></a>flights<span class="sc">$</span>dep_time <span class="sc">&gt;</span> <span class="dv">600</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
   [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE
...</code></pre>
</div>
</div>
<p>Using a comparator between two vectors of logicals returns pairwise comparisons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb124-2"><a href=""></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb124-3"><a href=""></a>(x <span class="sc">&amp;</span> y) <span class="co"># x AND y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE  TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href=""></a>(x <span class="sc">|</span> y) <span class="co"># x OR y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE FALSE  TRUE</code></pre>
</div>
</div>
</section>
<section id="comparisons-1" class="slide level2">
<h2>Comparisons</h2>
<p>So when we use multiple comparisons in <code>filter()</code>, we are building a new vector of logicals.</p>
<p>We only keep those rows where the vector is <code>TRUE</code>.</p>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb128-2"><a href=""></a>  <span class="fu">filter</span>(dep_time <span class="sc">&gt;</span> <span class="dv">600</span> <span class="sc">&amp;</span> dep_time <span class="sc">&lt;</span> <span class="dv">2000</span> <span class="sc">&amp;</span> <span class="fu">abs</span>(arr_delay) <span class="sc">&lt;</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 172,286 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      601            600         1      844            850
 2  2013     1     1      602            610        -8      812            820
 3  2013     1     1      602            605        -3      821            805
...</code></pre>
</div>
</div>
</section>
<section id="comparisons-2" class="slide level2">
<h2>Comparisons</h2>
<p><code>filter()</code> and <code>mutate()</code> can be used in conjunction</p>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb130-2"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb130-3"><a href=""></a>    <span class="at">daytime =</span> dep_time <span class="sc">&gt;</span> <span class="dv">600</span> <span class="sc">&amp;</span> dep_time <span class="sc">&lt;</span> <span class="dv">2000</span>,</span>
<span id="cb130-4"><a href=""></a>    <span class="at">approx_ontime =</span> <span class="fu">abs</span>(arr_delay) <span class="sc">&lt;</span> <span class="dv">20</span>,</span>
<span id="cb130-5"><a href=""></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb130-6"><a href=""></a>  <span class="fu">filter</span>(daytime <span class="sc">&amp;</span> approx_ontime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 172,286 × 21
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      601            600         1      844            850
 2  2013     1     1      602            610        -8      812            820
 3  2013     1     1      602            605        -3      821            805
...</code></pre>
</div>
</div>
</section>
<section id="floating-point-comparisons" class="slide level2">
<h2>Floating point comparisons</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Testing equality with <code>==</code> for floating points can cause problems. Numbers are represented with finite “precision”, i.e.&nbsp;only up to 2^{-32} or 2^{-64}.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>( (<span class="dv">1</span><span class="sc">/</span><span class="dv">49</span>) <span class="sc">*</span> <span class="dv">49</span>, <span class="fu">sqrt</span>(<span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb132-2"><a href=""></a>x <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE</code></pre>
</div>
</div>
<p>What’s going on? Let’s look at more precise representation in R. <!-- using `print(x, digits=)`: --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href=""></a><span class="fu">print</span>(x, <span class="at">digits=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href=""></a><span class="fu">print</span>(x, <span class="at">digits=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.99999999999999988898 2.00000000000000044409</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><code>dplyr::near()</code> helps with this, ignores small differences</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href=""></a><span class="fu">near</span>(x, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href=""></a><span class="fu">all.equal</span>(x, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))  <span class="co"># returns single value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</div></div>
</section>
<section id="missing-values" class="slide level2">
<h2>Missing values</h2>
<div class="columns">
<div class="column" style="width:35%;">
<p>Almost any operation involving an <code>NA</code> returns <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href=""></a>(<span class="cn">NA</span> <span class="sc">&gt;</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href=""></a>(<span class="dv">10</span> <span class="sc">==</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</div><div class="column" style="width:65%;">
<p>What about <code>NA==NA</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href=""></a><span class="cn">NA</span><span class="sc">==</span><span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>Why? Think of this example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href=""></a><span class="co"># Suppose we don't know Ant's age</span></span>
<span id="cb148-2"><a href=""></a>age_ant <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb148-3"><a href=""></a></span>
<span id="cb148-4"><a href=""></a><span class="co"># And we also don't know Bug's age</span></span>
<span id="cb148-5"><a href=""></a>age_bug <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb148-6"><a href=""></a></span>
<span id="cb148-7"><a href=""></a><span class="co"># Then we shouldn't know whether Ant and</span></span>
<span id="cb148-8"><a href=""></a><span class="co"># Bug are the same age</span></span>
<span id="cb148-9"><a href=""></a>age_ant <span class="sc">==</span> age_bug</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</div></div>
</section>
<section id="missing-values-1" class="slide level2">
<h2>Missing values</h2>
<p>A useful function for dealing with <code>NA</code>: <code>is.na()</code></p>
<p><code>is.na(x)</code> works with any type of vector and returns TRUE for missing values and FALSE for everything else:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href=""></a><span class="fu">is.na</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">NA</span>, <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href=""></a><span class="fu">is.na</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href=""></a><span class="fu">is.na</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="cn">NA</span>, <span class="st">"b"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE FALSE</code></pre>
</div>
</div>
</section>
<section id="missing-values-2" class="slide level2">
<h2>Missing values</h2>
<p>Since <code>is.na()</code> returns logicals, can be used in <code>filter()</code>:</p>
<div class="cell" data-output.lines="5">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb156-2"><a href=""></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(dep_time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,255 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1       NA           1630        NA       NA           1815
 2  2013     1     1       NA           1935        NA       NA           2240
...</code></pre>
</div>
</div>
<!-- ```{r, output.lines=5} -->
<!-- flights %>% -->
<!--   select(time_hour, flight, dep_time, arr_time, air_time) %>% -->
<!--   filter(is.na(air_time) & !is.na(arr_time) & !is.na(dep_time))  -->
<!-- ``` -->
</section>
<section id="missing-values-3" class="slide level2">
<h2>Missing values</h2>
<p>Can use to help identify where <code>NA</code> come from. e.g., why are there air_time <code>NA</code>s?</p>
<ul>
<li>Let’s examine how <code>dep_time</code>, <code>dep_delay</code>, and <code>sched_dep_time</code> are related.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href=""></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb158-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">missing_dep_time =</span> <span class="fu">is.na</span>(dep_time),</span>
<span id="cb158-3"><a href=""></a>         <span class="at">missing_dep_delay =</span> <span class="fu">is.na</span>(dep_delay),</span>
<span id="cb158-4"><a href=""></a>         <span class="at">missing_sched_dep_time =</span> <span class="fu">is.na</span>(sched_dep_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb158-5"><a href=""></a>  <span class="fu">count</span>(missing_dep_time, missing_dep_delay, missing_sched_dep_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  missing_dep_time missing_dep_delay missing_sched_dep_time      n
  &lt;lgl&gt;            &lt;lgl&gt;             &lt;lgl&gt;                   &lt;int&gt;
1 FALSE            FALSE             FALSE                  328521
2 TRUE             TRUE              FALSE                    8255</code></pre>
</div>
</div>
<ul>
<li>The only instances where <code>dep_delay</code> is missing have <code>dep_time</code> missing.</li>
</ul>
</section>
<section id="missing-values-4" class="slide level2">
<h2>Missing values</h2>
<ul>
<li>Is it the case that <code>dep_delay</code> = <code>dep_time</code> - <code>sched_dep_time</code>?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href=""></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb160-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">dep_delay_manual =</span> dep_time <span class="sc">-</span> sched_dep_time,</span>
<span id="cb160-3"><a href=""></a>         <span class="at">manual_matches_given =</span> <span class="fu">near</span>(dep_delay_manual, dep_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb160-4"><a href=""></a>  <span class="fu">count</span>(manual_matches_given)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  manual_matches_given      n
  &lt;lgl&gt;                 &lt;int&gt;
1 FALSE                 99777
2 TRUE                 228744
3 NA                     8255</code></pre>
</div>
</div>
<p>Quite weird, since we are getting a lot right but also getting a lot wrong.</p>
</section>
<section id="missing-values-5" class="slide level2">
<h2>Missing values</h2>
<p>Let’s inspect further. What do the mismatched observations look like?</p>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href=""></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb162-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">manual_delay =</span> dep_time <span class="sc">-</span> sched_dep_time,</span>
<span id="cb162-3"><a href=""></a>         <span class="at">manual_matches_given =</span> <span class="fu">near</span>(manual_delay, dep_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb162-4"><a href=""></a>  <span class="fu">filter</span>(<span class="sc">!</span>manual_matches_given) <span class="sc">%&gt;%</span></span>
<span id="cb162-5"><a href=""></a>  <span class="fu">select</span>(time_hour, flight, dep_time, sched_dep_time, dep_delay, manual_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 99,777 × 6
   time_hour           flight dep_time sched_dep_time dep_delay manual_delay
   &lt;dttm&gt;               &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;        &lt;int&gt;
 1 2013-01-01 06:00:00    461      554            600        -6          -46
 2 2013-01-01 06:00:00    507      555            600        -5          -45
 3 2013-01-01 06:00:00   5708      557            600        -3          -43
...</code></pre>
</div>
</div>
<p>Problem: <code>R</code> is treating <code>dep_time</code> and <code>sched_dep_time</code> as integers, not time!</p>
<ul>
<li>5:54 is only 6 minutes away from 6:00, rather than 46.</li>
<li>We might discuss later (after midterm 2) how to properly treat dates and times.</li>
</ul>
</section>
<section id="missing-values-in-boolean-algebra" class="slide level2">
<h2>Missing values in Boolean algebra</h2>
<p>Logical and missing values interact in logical, but maybe counterintuitive ways.</p>
<ul>
<li>Think of <code>NA</code> as “unknown” logical value.</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href=""></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb164-2"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb164-3"><a href=""></a>    <span class="at">and_NA =</span> x <span class="sc">&amp;</span> <span class="cn">NA</span>,</span>
<span id="cb164-4"><a href=""></a>    <span class="at">or_NA =</span> x <span class="sc">|</span> <span class="cn">NA</span></span>
<span id="cb164-5"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  x     and_NA or_NA
  &lt;lgl&gt; &lt;lgl&gt;  &lt;lgl&gt;
1 TRUE  NA     TRUE 
2 FALSE FALSE  NA   
3 NA    NA     NA   </code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Does not depend on value of <code>NA</code>:</p>
<ul>
<li><code>NA</code> OR <code>TRUE</code> will return <code>TRUE</code>.</li>
<li><code>NA</code> AND <code>FALSE</code> will return <code>FALSE</code>.</li>
</ul>
<p>Depends on value of <code>NA</code>:</p>
<ul>
<li><code>NA</code> AND <code>TRUE</code> will return <code>NA</code>.</li>
<li><code>NA</code> OR <code>FALSE</code> will return <code>NA</code>.</li>
</ul>
</div></div>
<!-- ## Order of operations -->
<!-- ::::: columns -->
<!-- ::: {.column width="50%"} -->
<!-- Consider finding all flights departing between November and December in the tibble. -->
<!-- ```{r,eval=FALSE} -->
<!-- flights %>% -->
<!--   filter(month == 11 | month == 12) -->
<!-- ``` -->
<!-- This results in the correct calculation. -->
<!-- However, the following calculation does not:  -->
<!-- ::: -->
<!-- ::: {.column width="50%"} -->
<!-- ```{r,output.lines=7} -->
<!-- flights %>% -->
<!--   filter(month == 11 | 12) -->
<!-- ``` -->
<!-- Why? -->
<!-- - R first evaluates `month==11`, creates a logical vector `vec`. -->
<!-- - R then compares `vec | 12` -->
<!-- - When comparing a number to any logical, every nonzero number is considered TRUE. -->
<!-- - So `vec | 12` returns a vector with TRUE for every element -->
<!-- ::: -->
<!-- ::::: -->
</section>
<section id="consider-finding-all-flights-departing-in-november-or-december." class="slide level2">
<h2>Consider finding all flights departing in November or December.</h2>
<div class="cell" data-output.lines="5">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href=""></a>flights <span class="sc">%&gt;%</span>  <span class="co"># results in correct calculation</span></span>
<span id="cb166-2"><a href=""></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">11</span> <span class="sc">|</span> month <span class="sc">==</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 55,403 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013    11     1        5           2359         6      352            345
 2  2013    11     1       35           2250       105      123           2356
...</code></pre>
</div>
</div>
<!-- This results in the correct calculation. -->
<!-- However, the following code does not:  -->
<div class="cell" data-output.lines="5">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href=""></a>flights <span class="sc">%&gt;%</span>  <span class="co"># results in incorrect calculation. (we get all rows back)</span></span>
<span id="cb168-2"><a href=""></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">11</span> <span class="sc">|</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
...</code></pre>
</div>
</div>
</section>
<section id="in" class="slide level2">
<h2><code>%in%</code></h2>
<p>Instead of worrying about <code>|</code> and <code>==</code> in order, just use <code>%in%</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href=""></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE</code></pre>
</div>
</div>
<p>So to find all flights from November and December:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb172-2"><a href=""></a>  <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>%in%</code> obeys different rules for <code>NA</code> vs.&nbsp;<code>==</code>, since <code>NA %in% NA</code> is TRUE:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href=""></a>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="cn">NA</span>) <span class="sc">==</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA NA NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href=""></a>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="cn">NA</span>) <span class="sc">%in%</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE  TRUE</code></pre>
</div>
</div>
</section>
<section id="logical-summaries" class="slide level2">
<h2>Logical summaries</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>Two main functions for logical summaries:</p>
<ul>
<li><code>any(x)</code> returns <code>TRUE</code> if any value in <code>x</code> is <code>TRUE</code></li>
<li><code>all(x)</code> returns <code>TRUE</code> only if all values in <code>x</code> are <code>TRUE</code></li>
</ul>
<p>For instance, was there a day where <em>every</em> flight was delayed on departure by less than an hour? Or a day where there were <em>any</em> flights delayed on arrival by <span class="math inline">\(\leq 5\)</span> hours?</p>
</div><div class="column" style="width:60%;">
<div class="cell" data-output.lines="8">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb177-2"><a href=""></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb177-3"><a href=""></a>  <span class="fu">summarize</span>(</span>
<span id="cb177-4"><a href=""></a>    <span class="at">all_delayed =</span> <span class="fu">all</span>(dep_delay <span class="sc">&lt;=</span> <span class="dv">60</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb177-5"><a href=""></a>    <span class="at">any_long_delay =</span> <span class="fu">any</span>(arr_delay <span class="sc">&gt;=</span> <span class="dv">300</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb177-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 5
# Groups:   year, month [12]
    year month   day all_delayed any_long_delay
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;lgl&gt;       &lt;lgl&gt;         
 1  2013     1     1 FALSE       TRUE          
 2  2013     1     2 FALSE       TRUE          
 3  2013     1     3 FALSE       FALSE         
 4  2013     1     4 FALSE       FALSE         
...</code></pre>
</div>
</div>
</div></div>
</section>
<section id="logical-summaries-1" class="slide level2">
<h2>Logical summaries</h2>
<ul>
<li>When coerced into a numeric, TRUE coerces to 1 and FALSE coerces to 0</li>
<li>Useful if you want to find proportions that are TRUE/FALSE, e.g. <code>mean()</code>, <code>sum()</code></li>
</ul>
</section>
<section id="logical-summaries-2" class="slide level2">
<h2>Logical summaries</h2>
<ul>
<li>Example: proportion of flights delayed &gt; 1 hour on departure, and number of flights delayed on arrival by &gt; 5 hours:</li>
</ul>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href=""></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href=""></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb179-3"><a href=""></a>  <span class="fu">summarise</span>(</span>
<span id="cb179-4"><a href=""></a>    <span class="at">prop_delayed_1hour =</span> <span class="fu">mean</span>(dep_delay <span class="sc">&gt;</span> <span class="dv">60</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb179-5"><a href=""></a>    <span class="at">num_long_delay =</span> <span class="fu">sum</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">300</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb179-6"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 5
# Groups:   year, month [12]
    year month   day prop_delayed_1hour num_long_delay
   &lt;int&gt; &lt;int&gt; &lt;int&gt;              &lt;dbl&gt;          &lt;int&gt;
 1  2013     1     1             0.0609              3
 2  2013     1     2             0.0856              3
 3  2013     1     3             0.0586              0
...</code></pre>
</div>
</div>
<p>Note output: <code># Groups:   year, month [12]</code></p>
</section>
<section id="logical-summaries-3" class="slide level2">
<h2>Logical summaries</h2>
<ul>
<li>Example: proportion of flights delayed &gt; 1 hour on departure, and number of flights delayed on arrival by &gt; 5 hours:</li>
</ul>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb181" data-code-line-numbers="6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href=""></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb181-2"><a href=""></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb181-3"><a href=""></a>  <span class="fu">summarise</span>(</span>
<span id="cb181-4"><a href=""></a>    <span class="at">prop_delayed_1hour =</span> <span class="fu">mean</span>(dep_delay <span class="sc">&gt;</span> <span class="dv">60</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb181-5"><a href=""></a>    <span class="at">num_long_delay =</span> <span class="fu">sum</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">300</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb181-6"><a href=""></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb181-7"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 5
    year month   day prop_delayed_1hour num_long_delay
   &lt;int&gt; &lt;int&gt; &lt;int&gt;              &lt;dbl&gt;          &lt;int&gt;
 1  2013     1     1             0.0609              3
 2  2013     1     2             0.0856              3
 3  2013     1     3             0.0586              0
...</code></pre>
</div>
</div>
</section>
<section id="conditional-transformations-if_else" class="slide level2">
<h2>Conditional transformations: <code>if_else()</code></h2>
<p><code>if_else(CONDITION, TRUE_VAL, FALSE_VAL, MISSING_VAL)</code> is useful when we want to return some value when condition is <code>TRUE</code> and return another value when condition is <code>FALSE</code>.</p>
<!-- * When condition is TRUE, it's one value.  When FALSE, it's another value. -->
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>)</span>
<span id="cb183-2"><a href=""></a><span class="fu">if_else</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"yay"</span>, <span class="st">"boo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "boo" "boo" "yay" "yay" NA   </code></pre>
</div>
</div>
<p>The fourth argument of <code>if_else()</code> specifies what to fill <code>NA</code>’s with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href=""></a><span class="fu">if_else</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"yay"</span>, <span class="st">"boo"</span>, <span class="st">"idk how i feel about x yet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "boo"                        "boo"                       
[3] "yay"                        "yay"                       
[5] "idk how i feel about x yet"</code></pre>
</div>
</div>
<p>We can also use vectors as an argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href=""></a><span class="fu">if_else</span>(x <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="sc">-</span>x, x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  1  1  2 NA</code></pre>
</div>
</div>
</section>
<section id="conditional-transformations-if_else-1" class="slide level2">
<h2>Conditional transformations: <code>if_else()</code></h2>
<p>We can use general vectors inside of <code>if_else()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href=""></a>x1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>)</span>
<span id="cb189-2"><a href=""></a>y1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">6</span>)</span>
<span id="cb189-3"><a href=""></a><span class="fu">if_else</span>(<span class="fu">is.na</span>(x1), y1, x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 1 2 6</code></pre>
</div>
</div>
</section>
<section id="conditional-transformations-case_when" class="slide level2">
<h2>Conditional transformations: <code>case_when()</code></h2>
<p>If you have <em>many</em> different conditions for which you want to specify values, e.g.</p>
<ul>
<li>If number is between <code>a</code> and <code>b</code> then do…</li>
<li>If number is between <code>b</code> and <code>c</code> then do…</li>
<li>If number is between <code>c</code> and <code>d</code> then do…</li>
</ul>
<p>You can use <code>case_when()</code>.</p>
</section>
<section id="conditional-transformations-case_when-1" class="slide level2">
<h2>Conditional transformations: <code>case_when()</code></h2>
<p>Inspired by SQL’s <code>CASE</code> statement. Has a very weird syntax:</p>
<ul>
<li><code>condition ~ output</code></li>
<li><code>condition</code> is a logical vector</li>
<li>when <code>condition</code> is <code>TRUE</code>, <code>output</code> is used.</li>
</ul>
<p>Weird, but pretty readable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>, <span class="cn">NA</span>)</span>
<span id="cb191-2"><a href=""></a><span class="fu">case_when</span>(</span>
<span id="cb191-3"><a href=""></a>  x <span class="sc">==</span> <span class="dv">0</span>   <span class="sc">~</span> <span class="st">"0"</span>,</span>
<span id="cb191-4"><a href=""></a>  x <span class="sc">&lt;</span> <span class="dv">0</span>    <span class="sc">~</span> <span class="st">"-ve"</span>, </span>
<span id="cb191-5"><a href=""></a>  x <span class="sc">&gt;</span> <span class="dv">0</span>    <span class="sc">~</span> <span class="st">"+ve"</span>,</span>
<span id="cb191-6"><a href=""></a>  <span class="fu">is.na</span>(x) <span class="sc">~</span> <span class="st">"???"</span></span>
<span id="cb191-7"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "-ve" "-ve" "-ve" "0"   "+ve" "+ve" "+ve" "???"</code></pre>
</div>
</div>
</section>
<section id="conditional-transformations-case_when-2" class="slide level2">
<h2>Conditional transformations: <code>case_when()</code></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>If no cases match, then returns <code>NA</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">:</span><span class="dv">2</span>, <span class="cn">NA</span>)</span>
<span id="cb193-2"><a href=""></a><span class="fu">case_when</span>(</span>
<span id="cb193-3"><a href=""></a>  x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"-ve"</span>,</span>
<span id="cb193-4"><a href=""></a>  x <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"+ve"</span></span>
<span id="cb193-5"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "-ve" "-ve" NA    "+ve" "+ve" NA   </code></pre>
</div>
</div>
<p>If multiple conditions are satisfied, only the first is used – be careful!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href=""></a><span class="fu">case_when</span>(</span>
<span id="cb195-2"><a href=""></a>  x <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"+ve"</span>,</span>
<span id="cb195-3"><a href=""></a>  x <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"big"</span></span>
<span id="cb195-4"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA    NA    NA    "+ve" "+ve" NA   </code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>The argument <code>.default</code> specifies return value if condition is satisfied, or if value is <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href=""></a><span class="fu">case_when</span>(</span>
<span id="cb197-2"><a href=""></a>  x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"-ve"</span>,</span>
<span id="cb197-3"><a href=""></a>  x <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"+ve"</span>,</span>
<span id="cb197-4"><a href=""></a>  <span class="at">.default =</span> <span class="st">"???"</span></span>
<span id="cb197-5"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "-ve" "-ve" "???" "+ve" "+ve" "???"</code></pre>
</div>
</div>
</div></div>
</section>
<section id="case_when-more-complex-example" class="slide level2">
<h2><code>case_when()</code>: more complex example</h2>
<div class="columns">
<div class="column" style="width:70%;">
<p>Provide human-readable labels to flight delays.</p>
<div class="cell" data-output.lines="5">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href=""></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb199-2"><a href=""></a>  <span class="fu">mutate</span>(</span>
<span id="cb199-3"><a href=""></a>    <span class="at">status =</span> <span class="fu">case_when</span>(</span>
<span id="cb199-4"><a href=""></a>      <span class="fu">is.na</span>(arr_delay)      <span class="sc">~</span> <span class="st">"cancelled"</span>,</span>
<span id="cb199-5"><a href=""></a>      arr_delay <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">30</span>       <span class="sc">~</span> <span class="st">"very early"</span>,</span>
<span id="cb199-6"><a href=""></a>      arr_delay <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">15</span>       <span class="sc">~</span> <span class="st">"early"</span>,</span>
<span id="cb199-7"><a href=""></a>      <span class="fu">abs</span>(arr_delay) <span class="sc">&lt;=</span> <span class="dv">15</span>  <span class="sc">~</span> <span class="st">"on time"</span>,</span>
<span id="cb199-8"><a href=""></a>      arr_delay <span class="sc">&lt;</span> <span class="dv">60</span>        <span class="sc">~</span> <span class="st">"late"</span>,</span>
<span id="cb199-9"><a href=""></a>      arr_delay <span class="sc">&lt;</span> <span class="cn">Inf</span>       <span class="sc">~</span> <span class="st">"very late"</span>,</span>
<span id="cb199-10"><a href=""></a>    ),</span>
<span id="cb199-11"><a href=""></a>    <span class="at">.keep =</span> <span class="st">"used"</span> <span class="co"># only returns those columns used in calculations</span></span>
<span id="cb199-12"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 2
   arr_delay status 
       &lt;dbl&gt; &lt;chr&gt;  
 1        11 on time
 2        20 late   
...</code></pre>
</div>
</div>
</div><div class="column" style="width:30%;">
<ul>
<li>We can refer to variables inside the dataframe inside <code>case_when()</code>, just as in most other <code>tidyverse</code> functions .</li>
<li>The first conditional that is true is what gets assigned.</li>
<li>So when <code>arr_delay &lt; -30</code>, the remaining conditionals do not get checked.</li>
</ul>
</div></div>
<!-- ## `case_when()` -->
<!-- ::::: columns -->
<!-- ::: {.column width="50%"} -->
<!-- Two equivalent ways of using `case_when` for this problem: -->
<!-- ```{r,output.lines = 7} -->
<!-- df1 <- flights |> -->
<!--   mutate( -->
<!--     status = case_when( -->
<!--       is.na(arr_delay)      ~ "cancelled", -->
<!--       arr_delay < -30       ~ "very early", -->
<!--       arr_delay < -15       ~ "early", -->
<!--       abs(arr_delay) <= 15  ~ "on time", -->
<!--       arr_delay < 60        ~ "late", -->
<!--       arr_delay < Inf       ~ "very late", -->
<!--     ), -->
<!--     .keep = "used" # only returns those columns used in calc -->
<!--   ) -->
<!-- ``` -->
<!-- ::: -->
<!-- ::: {.column width="50%"} -->
<!-- ```{r} -->
<!-- df2 <- flights |> -->
<!--   mutate( -->
<!--     status = case_when( -->
<!--       is.na(arr_delay)      ~ "cancelled", -->
<!--       arr_delay < -30       ~ "very early", -->
<!--       arr_delay < -15       ~ "early", -->
<!--       abs(arr_delay) <= 15  ~ "on time", -->
<!--       arr_delay < 60        ~ "late", -->
<!--       .default = "very late" -->
<!--     ), -->
<!--     .keep = "used" # only returns those columns used in calc -->
<!--   ) -->
<!-- all.equal(df1, df2) -->
<!-- ``` -->
<!-- Recall that `.default` says how all `NA` and non-specified conditions are handled.  Since we have already used that `NA` implies canceled, this does the same thing. -->
<!-- ::: -->
<!-- ::::: -->
</section>
<section id="compatible-types" class="slide level2">
<h2>Compatible types</h2>
<p>Both <code>if_else()</code> and <code>case_when()</code> require the outputs to be of consistent types.<br>
<!-- If not, you'll get errors, e.g. --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href=""></a><span class="fu">if_else</span>(<span class="cn">TRUE</span>, <span class="st">"a"</span>, <span class="dv">1</span>)</span>
<span id="cb201-2"><a href=""></a><span class="co">#&gt; Error in `if_else()`:</span></span>
<span id="cb201-3"><a href=""></a><span class="co">#&gt; ! Can't combine `true` &lt;character&gt; and `false` &lt;double&gt;.</span></span>
<span id="cb201-4"><a href=""></a></span>
<span id="cb201-5"><a href=""></a><span class="fu">case_when</span>(</span>
<span id="cb201-6"><a href=""></a>  x <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb201-7"><a href=""></a>  x <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">now</span>()</span>
<span id="cb201-8"><a href=""></a>)</span>
<span id="cb201-9"><a href=""></a><span class="co">#&gt; Error in `case_when()`:</span></span>
<span id="cb201-10"><a href=""></a><span class="co">#&gt; ! Can't combine `..1 (right)` &lt;logical&gt; and `..2 (right)` &lt;datetime&lt;local&gt;&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Most types are incompatible in order to catch errors. Compatible types:</p>
<ul>
<li>Numeric and logical (treats TRUE=1, FALSE=0)</li>
<li>Dates and “date-times” – we might discuss these types after midterm 2</li>
<li><code>NA</code> is compatible with everything</li>
<li>Strings and factors are compatible</li>
</ul>
</section>
<section id="example-labelling-numbers-as-even-or-odd" class="slide level2">
<h2>Example: labelling numbers as even or odd</h2>
<ul>
<li>Number is even <span class="math inline">\(\Leftrightarrow\)</span> number is divisible by two.</li>
<li>In R, operator <code>%%</code> (read “modulo”) does “modular arithmetic”:</li>
<li><code>a %% b</code> returns the remainder when dividing <code>a</code> by <code>b</code>, e.g.
<ul>
<li><code>17 %% 12 = 5</code></li>
<li><code>34 %% 6 = 4</code></li>
</ul></li>
<li>A number <code>n</code> is even if and only if <code>n %% 2 == 0</code>; otherwise, odd.</li>
<li>We can use <code>if_else</code> to label numbers between 0 and 20 as even or odd</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb202-2"><a href=""></a><span class="fu">if_else</span>(x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>, <span class="st">'even'</span>, <span class="st">'odd'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "even" "odd"  "even" "odd"  "even" "odd"  "even" "odd"  "even" "odd" 
[11] "even" "odd"  "even" "odd"  "even" "odd"  "even" "odd"  "even" "odd" 
[21] "even"</code></pre>
</div>
</div>
</section></section>
<section>
<section id="operating-on-numeric-vectors" class="title-slide slide level1 center">
<h1>Operating on numeric vectors</h1>
<!-- ## Intro -->
<!-- This section will focus on transforming numbers.  -->
<!-- ```{r, output.lines=7} -->
<!-- library(tidyverse) -->
<!-- library(nycflights13) -->
<!-- flights -->
<!-- ``` -->
</section>
<section id="parsing-strings-to-get-numbers" class="slide level2">
<h2>Parsing strings to get numbers</h2>
<p><code>readr</code> package in the tidyverse has two useful functions:</p>
<ul>
<li><code>parse_double()</code> – useful when you have numbers written as strings.</li>
<li><code>parse_number()</code> – ignores all non-numeric text to parse strings.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href=""></a><span class="fu">parse_double</span>(<span class="fu">c</span>(<span class="st">"1.2"</span>, <span class="st">"5.6"</span>, <span class="st">"1e3"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]    1.2    5.6 1000.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href=""></a><span class="fu">parse_number</span>(<span class="fu">c</span>(<span class="st">"$1,234"</span>, <span class="st">"USD 53,256"</span>, <span class="st">"59%"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1234 53256    59</code></pre>
</div>
</div>
</section>
<section id="parsing-strings-to-get-numbers-1" class="slide level2">
<h2>Parsing strings to get numbers</h2>
<p>What happens if use <code>parse_double()</code> with non-numeric-identifying strings?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">parse_double</span>(<span class="fu">c</span>(<span class="st">"qwerty"</span>, <span class="st">"6.5"</span>, <span class="st">"asdf"</span>))</span>
<span id="cb208-2"><a href=""></a><span class="fu">str</span>(x)  <span class="co"># shows that x is a vector with informative attributes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:3] NA 6.5 NA
 - attr(*, "problems")= tibble [2 × 4] (S3: tbl_df/tbl/data.frame)
  ..$ row     : int [1:2] 1 3
  ..$ col     : int [1:2] NA NA
  ..$ expected: chr [1:2] "a double" "a double"
  ..$ actual  : chr [1:2] "qwerty" "asdf"</code></pre>
</div>
</div>
<p>Can access this tibble by <code>attributes(x)$problems</code></p>
</section>
<section id="arithmetic-and-recycling-rules" class="slide level2">
<h2>Arithmetic and “recycling rules”</h2>
<ul>
<li>We’ve created new rows before
<ul>
<li>e.g.&nbsp;<code>flights %&gt;% mutate(air_time_hr = air_time / 60)</code>.</li>
<li><code>air_time</code> has 336,776 elements while 60 has only one, so we divide every element of <code>air_time</code> by 60.</li>
</ul></li>
<li>If you have two vectors of same length, operations are done element-wise:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb210-2"><a href=""></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb210-3"><a href=""></a>x <span class="sc">/</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5000000 0.6666667 0.7500000 0.8000000</code></pre>
</div>
</div>
</section>
<section id="arithmetic-and-recycling-rules-1" class="slide level2">
<h2>Arithmetic and “recycling rules”</h2>
<p>What happens if the number of elements is not 1 or the exact matching number?</p>
<ul>
<li><p>R does what is called <strong>recycling</strong>, or <strong>repeating</strong></p>
<ul>
<li>It will create a new vector which repeats until reaches vector length.<br>
</li>
<li>Will throw warning if not an even multiple.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">4</span>)</span>
<span id="cb212-2"><a href=""></a>x <span class="sc">*</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1 -4 -3 -8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href=""></a>x <span class="sc">*</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in x * c(5, 6, 7): longer object length is not a multiple of shorter
object length</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  -5 -12 -21 -20</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="recycling-rules" class="slide level2">
<h2>Recycling rules</h2>
<p>Rules apply for all logical comparison (<code>==</code>, <code>&lt;</code>, etc) and arithmetic (<code>+</code>, <code>^</code>, etc)</p>
<ul>
<li>Be careful when doing logical comparisons / arithmetic using two vectors!</li>
</ul>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href=""></a>flights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25,977 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      542            540         2      923            850
 3  2013     1     1      554            600        -6      812            837
...</code></pre>
</div>
</div>
<ul>
<li><p><code>month == c(1,2)</code> returns a logical vector where:</p>
<ul>
<li><code>TRUE</code> if either the row number is odd and the month is 1, OR row number is even and month 2. Otherwise is <code>FALSE</code>.</li>
</ul></li>
<li><p>Better to use <code>month %in% c(1,2)</code> here!</p>
<!-- * `FALSE` if either the row number is odd and the month is NOT 1, OR row number is even and month is NOT 2 --></li>
</ul>
</section>
<section id="parallel-minimums-and-maximums" class="slide level2">
<h2>Parallel minimums and maximums</h2>
<p><code>pmin()</code> and <code>pmax()</code> return parallel min / max of 2 or more variables</p>
<div class="columns">
<div class="column" style="width:35%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href=""></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
      x     y     z
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     3     5
2     5     2     7
3     7    NA     1</code></pre>
</div>
</div>
</div><div class="column" style="width:65%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href=""></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb221-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">min =</span> <span class="fu">pmin</span>(x, y, z, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb221-3"><a href=""></a>         <span class="at">max =</span> <span class="fu">pmax</span>(x, y, z, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
      x     y     z   min   max
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     3     5     1     5
2     5     2     7     2     7
3     7    NA     1     1     7</code></pre>
</div>
</div>
</div></div>
</section>
<section id="parallel-minimums-and-maximums-1" class="slide level2">
<h2>Parallel minimums and maximums</h2>
<p>Different behavior than using <code>min()</code>, <code>max()</code>, which returns a single value:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href=""></a>df <span class="sc">%&gt;%</span></span>
<span id="cb223-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">bad_min =</span> <span class="fu">min</span>(x, y, z, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb223-3"><a href=""></a>         <span class="at">bad_max =</span> <span class="fu">max</span>(x, y, z, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
      x     y     z bad_min bad_max
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1     1     3     5       1       7
2     5     2     7       1       7
3     7    NA     1       1       7</code></pre>
</div>
</div>
</section>
<section id="modular-arithmetic" class="slide level2">
<h2>Modular arithmetic</h2>
<!-- Modular arithmetic is similar to "clock arithmetic", except you always start from 0 instead of 1 -->
<p>Recall from grade school: <strong>division by remainder</strong>.</p>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li><code>%/%</code>: integer division</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href=""></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">%/%</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 0 1 1 1 2 2 2 3 3</code></pre>
</div>
</div>
<ul>
<li><code>%%</code>: the remainder after integer division.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href=""></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">%%</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 0 1 2 0 1 2 0 1</code></pre>
</div>
</div>
</div><div class="column fragment" style="width:60%;">
<p>Useful for time-related calculations, e.g.&nbsp;get hour and minute from <code>sched_dep_time</code>:</p>
<div class="cell" data-output.lines="7">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href=""></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb229-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">hour =</span> sched_dep_time <span class="sc">%/%</span> <span class="dv">100</span>,</span>
<span id="cb229-3"><a href=""></a>         <span class="at">minute =</span> sched_dep_time <span class="sc">%%</span> <span class="dv">100</span>,</span>
<span id="cb229-4"><a href=""></a>         <span class="at">.keep =</span> <span class="st">'used'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 3
   sched_dep_time  hour minute
            &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1            515     5     15
 2            529     5     29
 3            540     5     40
 4            545     5     45
...</code></pre>
</div>
</div>
</div></div>
</section>
<section id="modular-arithmetic-1" class="slide level2">
<h2>Modular arithmetic</h2>
<p>We can then do things like calculate the percent of delayed flights per hour.</p>
<div class="cell" data-output.lines="11">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href=""></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb231-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">hour =</span> sched_dep_time <span class="sc">%/%</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb231-3"><a href=""></a>  <span class="fu">group_by</span>(hour) <span class="sc">%&gt;%</span></span>
<span id="cb231-4"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">percent_cancelled =</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">mean</span>(<span class="fu">is.na</span>(dep_time)),</span>
<span id="cb231-5"><a href=""></a>            <span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
    hour percent_cancelled     n
   &lt;dbl&gt;             &lt;dbl&gt; &lt;int&gt;
 1     1           100         1
 2     5             0.461  1953
 3     6             1.64  25951
 4     7             1.27  22821
 5     8             1.62  27242
 6     9             1.61  20312
 7    10             1.74  16708
 8    11             1.85  16033
...</code></pre>
</div>
</div>
</section>
<section id="rounding-round" class="slide level2">
<h2>Rounding: <code>round()</code></h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>…to either nearest integer</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href=""></a><span class="fu">round</span>(pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<!-- * ...to certain number of decimal places -->
<!-- ```{r} -->
<!-- round(pi, digits=3) -->
<!-- ``` -->
<ul>
<li>…rounds (an integer + 0.5) to the nearest <strong>even</strong> integer</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href=""></a><span class="fu">round</span>(<span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">4.5</span>, <span class="fl">5.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 2 4 6</code></pre>
</div>
</div>
</div><div class="column fragment" style="width:50%;">
<!-- or to the nearest `10^n` if `n < 0`. -->
<ul>
<li><code>round(x, digits=n)</code> rounds to <code>n</code> digits past the decimal place (if <code>n</code>&gt;0)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href=""></a><span class="fu">round</span>(<span class="fl">123.456</span>, <span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 123.46</code></pre>
</div>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href=""></a><span class="fu">round</span>(<span class="fl">123.456</span>, <span class="at">digits=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 123.5</code></pre>
</div>
</div>
<ul>
<li>What happens if <code>n</code>&lt;0?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href=""></a><span class="fu">round</span>(<span class="fl">123.456</span>, <span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 120</code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href=""></a><span class="fu">round</span>(<span class="fl">123.456</span>, <span class="sc">-</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100</code></pre>
</div>
</div>
</div></div>
</section>
<section id="rounding" class="slide level2">
<h2>Rounding</h2>
<ul>
<li><p>Two similar arguments: <code>floor()</code> and <code>ceiling()</code></p>
<ul>
<li><code>floor(x)</code> rounds to greatest integer &lt;= x</li>
<li><code>ceiling(x)</code> rounds to least integer &gt;= x.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href=""></a><span class="fu">floor</span>(<span class="fl">123.456</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 123</code></pre>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href=""></a><span class="fu">ceiling</span>(<span class="fl">123.456</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 124</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="cumulative-and-rolling-aggregates" class="slide level2">
<h2>Cumulative and rolling aggregates</h2>
<ul>
<li><p>R provides many functions for computing rolling (i.e., cumulative) aggregates</p>
<ul>
<li>sums, products, minimums, etc.</li>
<li><code>cumsum()</code>, <code>cumprod()</code>, <code>cummin()</code>, <code>cummax()</code>, <code>dplyr::cummean()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="dv">9</span><span class="sc">:</span><span class="dv">1</span></span>
<span id="cb249-2"><a href=""></a><span class="fu">cumsum</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  9 17 24 30 35 39 42 44 45</code></pre>
</div>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href=""></a><span class="fu">cummean</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.0 8.5 8.0 7.5 7.0 6.5 6.0 5.5 5.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href=""></a><span class="fu">cumprod</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]      9     72    504   3024  15120  60480 181440 362880 362880</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href=""></a><span class="fu">cummin</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9 8 7 6 5 4 3 2 1</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="ranks-dplyrmin_rank" class="slide level2">
<h2>Ranks: <code>dplyr::min_rank()</code></h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Takes a vector of numbers and returns the rank of each element, with lowest = 1st.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href=""></a><span class="fu">min_rank</span>(<span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 1 3 4</code></pre>
</div>
</div>
<ul>
<li>Ties broken in obvious way: 1st, 2nd, 2nd, 4th if second and third element equal.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">62</span>, <span class="dv">62</span>, <span class="dv">64</span>, <span class="cn">NA</span>, <span class="dv">20</span>)</span>
<span id="cb259-2"><a href=""></a><span class="fu">min_rank</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  2  4 NA  1</code></pre>
</div>
</div>
<ul>
<li>To rank large values first, use <code>desc(x)</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href=""></a><span class="fu">min_rank</span>(<span class="fu">desc</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  2  1 NA  4</code></pre>
</div>
</div>
</div><div class="column fragment" style="width:40%;">
<p>There are many variants of <code>min_rank()</code> in <code>dplyr</code>:</p>
<ul>
<li><code>row_number()</code>, <code>cume_dist()</code>, <code>percent_rank()</code></li>
<li>You can explore these on your own; <code>min_rank()</code> is enough in most cases. <!-- ```{r} --> <!-- tibble(x_vals = x) %>% --> <!--   mutate(row_num = row_number(x), --> <!--          percent_rank = percent_rank(x), --> <!--          cumulative_dist = cume_dist(x) --> <!-- ) --> <!-- ``` --></li>
</ul>
<!-- proportion of values <= x.  -->
</div></div>
</section>
<section id="ranks-dplyrmin_rank-1" class="slide level2">
<h2>Ranks: <code>dplyr::min_rank()</code></h2>
<p>Example: which 3 flight routes have the longest average delays?</p>
<ul>
<li>flight route determined by <code>origin</code> and <code>dest</code></li>
<li>negative <code>arr_delay</code> means the flight left early</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href=""></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb263-2"><a href=""></a>  <span class="fu">filter</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb263-3"><a href=""></a>  <span class="fu">group_by</span>(origin, dest) <span class="sc">%&gt;%</span></span>
<span id="cb263-4"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">avg_delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb263-5"><a href=""></a>            <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb263-6"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(avg_delay))) <span class="sc">%&gt;%</span></span>
<span id="cb263-7"><a href=""></a>  <span class="fu">filter</span>(rank <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb263-8"><a href=""></a>  <span class="fu">arrange</span>(<span class="at">by =</span> rank)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  origin dest  avg_delay  rank
  &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;
1 LGA    TVC        72.7     1
2 EWR    TYS        72.6     2
3 LGA    OMA        65.0     3</code></pre>
</div>
</div>
<!-- ## Consecutive identifiers -->
<!-- ::::: columns -->
<!-- ::: {.column width="50%"} -->
<!-- * Suppose we are given times that a user has visited some website: -->
<!-- ```{r} -->
<!-- events <- tibble(time = c(0, 1, 2, 3, 5, 10, 12, 15, 17, 19, 20, 27)) -->
<!-- ``` -->
<!-- * Suppose we want to create an ID called "session", where a new session starts if it has been > 5 minutes since last visit. -->
<!-- * We can compute the time elapsed between visits using `lag()`, and let first visit be treated as 0 minutes since last visit. -->
<!-- ```{r} -->
<!-- events <- events %>%  -->
<!--   mutate( -->
<!--     diff = time - lag(time, default = first(time)), -->
<!--     five_mins_since = diff >= 5 -->
<!--   ) -->
<!-- ``` -->
<!-- ::: -->
<!-- ::: {.column width="50%"} -->
<!-- * The "session" ID will start at 0 and increase by 1 every time it `five_mins_since` hits a TRUE. -->
<!-- * To do this, we can use `cumsum()`: -->
<!-- ```{r} -->
<!-- events %>% -->
<!--   mutate(session = cumsum(five_mins_since)) -->
<!-- ``` -->
<!-- ::: -->
<!-- ::::: -->
</section>
<section id="minimum-maximum-quantiles" class="slide level2">
<h2>Minimum, maximum, quantiles</h2>
<div class="columns">
<div class="column" style="width:55%;">
<ul>
<li>Again, <code>min(x)</code> and <code>max(x)</code> return single smallest/largest vals within vector <code>x</code>.</li>
<li><code>quantile(vector, threshold)</code> is a generalization of median:
<ul>
<li><code>quantile(x, 0.25)</code> returns value of <code>x</code> that is &gt;= 25% of values within <code>x</code></li>
<li><code>quantile(x, 0.5)</code> returns median</li>
<li><code>quantile(x, 0.95)</code> returns value of <code>x</code> that is &gt;= 95% of values within <code>x</code>.</li>
</ul></li>
<li>Compare to the mean, quantiles are less susceptible to extreme values
<ul>
<li>Consider <code>c(1, 2, 3, 2, 5, 2, 3, 1, 4, 2, 3, 1, 5, 2, 10000000)</code></li>
</ul></li>
</ul>
</div><div class="column fragment" style="width:45%;">
<p>Example: calculate the maximum delay and the 95th quantile of delays for flights per day.</p>
<div class="cell" data-output.lines="6">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href=""></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb265-2"><a href=""></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb265-3"><a href=""></a>  <span class="fu">summarise</span>(</span>
<span id="cb265-4"><a href=""></a>    <span class="at">maxim =</span> <span class="fu">max</span>(dep_delay, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb265-5"><a href=""></a>    <span class="at">q95 =</span> <span class="fu">quantile</span>(dep_delay, <span class="fl">0.95</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb265-6"><a href=""></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb265-7"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 5
    year month   day maxim   q95
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  2013     1     1   853  70.1
 2  2013     1     2   379  85  
 3  2013     1     3   291  68  
...</code></pre>
</div>
</div>
</div></div>
<!-- ## Spread -->
<!-- * Standard measures of spread (you should already be familiar with these): -->
<!--   * Variance `var()`: $var(x) = \frac{1}{\mathsf{length}(x)-1} \sum_{i=1}^{\mathsf{length}(x)} (x[i] - \mathsf{mean}(x))^2$ -->
<!--   * Standard deviation `sd()`: $sd(x) = \sqrt{var(x)}$ -->
<!--   * Interquartile range contains middle 50% of data: -->
<!--     * `IQR(x) = quantile(x, 0.75) - quantile(x, 0.25)` -->
<!-- * IQR is less sensitive to big outliers compared to standard deviation. -->
<!--   * Similar to median vs. mean. -->
<!-- ## Spread: example -->
<!-- <!-- If the data were a Standard Normal (no outliers),  -->
<p>–&gt;</p>
<!-- 50% of Standard Normal data lies within 0.6745 stddev's of the mean. True here? -->
<!-- ```{r, output.lines=9} -->
<!-- flights %>%  -->
<!--   group_by(year, month, day) %>% -->
<!--   summarise( -->
<!--     stddev_50p_range = 0.6745*sd(dep_delay, na.rm=TRUE), -->
<!--     iqr = IQR(dep_delay, na.rm=TRUE), -->
<!--     .groups = 'drop' -->
<!--   ) -->
<!-- ``` -->
<!-- ## Spread: example -->
<!-- Which destinations show the greatest variation in air speed? Possible metrics: -->
<!-- * Middle 90% by quantiles; Within 2 standard deviations; Maximum minus minimum. -->
<!--   <!-- * Standard deviation requires $\geq 2$ observations in each destination. (Why?) -->
<p>–&gt;</p>
<!-- <!-- We need to be sure to only look at destinations with > 1 observation, otherwise can't compute stddev.  -->
<p>–&gt;</p>
<!-- ```{r, output.lines=5} -->
<!-- flights %>% -->
<!--   mutate(air_speed_mph = distance / (air_time / 60)) %>% -->
<!--   group_by(dest) %>% -->
<!--   filter(n() > 1) %>%  # Q: why do we need this? -->
<!--   summarize( -->
<!--     speed_middle90 = quantile(air_speed_mph, 0.95, na.rm=TRUE) - quantile(air_speed_mph, 0.05, na.rm=TRUE), -->
<!--     speed_2stddev = 2*sd(air_speed_mph, na.rm=TRUE), -->
<!--     speed_max_diff = max(air_speed_mph, na.rm=TRUE) - min(air_speed_mph, na.rm=TRUE)  -->
<!--   ) %>% arrange(by = desc(speed_middle90)) -->
<!-- ``` -->
</section></section>
<section id="visualizing-data-with-ggplot2" class="title-slide slide level1 center">
<h1>Visualizing data with <code>ggplot2</code></h1>
<!-- ## Basic structure of `ggplot2` -->
<!-- `ggplot()` constructs the initial plot. -->
<!-- -   The first argument of `ggplot()` is the data set for the plot. -->
<!--     -   The data set must be a data frame. -->
<!--     -   Optional: a *tibble* is a data frame with user-friendly add-ons -->
<!-- -   `ggplot(data = mpg)` creates an empty plot. -->
<!-- You then add one or more layers to `ggplot()` using `+`. -->
<!-- -   `geom` functions add a geometrical object to the plot. -->
<!--     -   `geom_point()`, `geom_smooth()`, `geom_histogram()`, `geom_boxplot()`, etc. -->
<!-- ##  -->
<!-- ::: panel-tabset -->
<!-- ## data set -->
<!-- ```{r output.lines=6} -->
<!-- library(ggplot2)  # mpg comes from ggplot2 -->
<!-- mpg  # is a tibble -->
<!-- str(mpg) -->
<!-- ``` -->
<!-- ## summary -->
<!-- ```{r} -->
<!-- library(ggplot2)  # mpg comes from ggplot2 -->
<!-- summary(mpg) -->
<!-- ``` -->
<!-- ## 0 layers -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg)  # creates an empty plot -- we haven't added any layers yet -->
<!-- ``` -->
<!-- ## 1 layer -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +  -->
<!--     geom_point(aes(x=cty, y=hwy)) -->
<!-- ``` -->
<!-- ## 2 layers -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +   -->
<!--     geom_point(aes(x=cty, y=hwy)) +  -->
<!--     geom_smooth(aes(x=cty, y=hwy), method='lm', se=FALSE)  # can add more than one layer -->
<!-- ``` -->
<!-- ## boxplot -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +   -->
<!--     geom_boxplot(aes(x=class, y=hwy)) -->
<!-- ``` -->
<!-- ## with jitter -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +   -->
<!--     geom_boxplot(aes(x=class, y=hwy)) + -->
<!--     geom_jitter(aes(x=class, y=hwy), width=0.2, alpha=0.5)  # width of jitter, alpha sets transparency -->
<!-- ``` -->
<!-- ::: -->
<!-- ## Aesthetics `aes()` in `ggplot2` -->
<!-- -   Each `geom` function in `ggplot2` takes a mapping argument. This defines how variables in your dataset are mapped to visual properties. -->
<!-- -   The mapping argument is always paired with `aes()`, and the `x` and `y` arguments of `aes()` specify which variables to map to the `x` and `y` axes. -->
<!-- -   An aesthetic is a visual property of the objects in the plot. Aesthetics include things like the size, the shape, or the color of the points. -->
<!-- -   Aesthetics `aes()` must be specified either in `ggplot()` or in the added layer(s). -->
<!-- -   The arguments of aesthetics are names of the columns of the dataset. -->
<!-- ```{r} -->
<!-- # ggplot(data = <DATA>) +  -->
<!-- #     GEOM\_FUNCTION>(mapping = aes(<MAPPINGS>)) -->
<!-- ``` -->
<!-- ##  -->
<!-- ::: panel-tabset -->
<!-- ## color -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +  -->
<!--     geom_point(aes(x=cty, y=hwy, color=class)) -->
<!-- ``` -->
<!-- ## red -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +  -->
<!--     geom_point(aes(x=cty, y=hwy), color='red') -->
<!-- ``` -->
<!-- ## red bad -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +  -->
<!--     geom_point(aes(x=cty, y=hwy, color='red')) -->
<!-- ``` -->
<!-- ## shape red bad -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +  -->
<!--     geom_point(aes(x=cty, y=hwy, shape=class, color='red')) -->
<!-- ``` -->
<!-- ## shape red good -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +  -->
<!--     geom_point(aes(x=cty, y=hwy, shape=class), color='red') -->
<!-- ``` -->
<!-- ::: -->
<!-- ## Further features -->
<!-- Besides the basic syntax and some major geometries: -->
<!-- -   Global vs. local mappings. -->
<!-- -   Plotting more than two variables with `aes()` or with facets (`facet_grid()` and `facet_wrap()`). -->
<!-- -   Statistical transformations. -->
<!-- -   Coordinate systems. -->
<!-- -   Adding annotations and customizing titles/labels. -->
<!-- -   Themes. -->
<!-- -   Saving plots using `ggsave()` -->
<!-- ##  -->
<!-- ::: panel-tabset -->
<!-- ## 2+ variables -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +  -->
<!--     geom_point(aes(x=cty, y=hwy)) + -->
<!--     facet_wrap(class~.) + # option to have each subplot have own x/y range  -->
<!--     labs(title='This title is shared for all subplots!', subtitle='and so are the axis labels/values') -->
<!-- ``` -->
<!-- ## Transformations -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +  -->
<!--     geom_point(aes(x=log(cty), y=log(hwy))) -->
<!-- ``` -->
<!-- ## Background -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +  -->
<!--     geom_point(aes(x=cty, y=hwy)) +  -->
<!--     theme_bw() -->
<!-- ``` -->
<!-- ## Plot themes -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +  -->
<!--     geom_point(aes(x=cty, y=hwy)) +  -->
<!--     theme(panel.grid.minor = element_blank())  # turns off minor grid lines -->
<!-- ``` -->
<!-- ## Axis labels -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +   -->
<!--     geom_point(aes(x=cty, y=hwy)) +  -->
<!--     geom_smooth(aes(x=cty, y=hwy), method='lm', se=FALSE) + -->
<!--     labs(x='city mpg', y='highway mpg', title='I love cars', subtitle="But I don't love driving") -->
<!-- ``` -->
<!-- ## All -->
<!-- ```{r} -->
<!-- library(ggplot2) -->
<!-- ggplot(data=mpg) +   -->
<!--     geom_point(aes(x=cty, y=hwy), color='red') +  -->
<!--     geom_smooth(aes(x=cty, y=hwy), method='lm', se=FALSE) + -->
<!--     facet_wrap(class~.) + -->
<!--     labs(x='city mpg', y='highway mpg', title='I love cars', subtitle="But I don't love driving") +  -->
<!--     theme_bw() +  -->
<!--     theme(panel.grid.minor = element_blank())   -->
<!-- ``` -->
<!-- ::: -->
<!-- ## Examples in action -->
<!-- Many extensions: <https://exts.ggplot2.tidyverse.org/gallery/> -->
<!-- <https://arxiv.org/pdf/2208.02806> -->
<div class="quarto-auto-generated-content">
<div class="footer footer-default">
<p>University of California, Davis · STA141A · Spring 2025</p>
</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="sec3_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="sec3_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="sec3_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="sec3_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="sec3_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="sec3_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="sec3_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="sec3_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="sec3_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="sec3_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'h.v',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>